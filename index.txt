<div class="global-filters card">
    <div class="filter-group">
        <label for="startDate">ì‹œì‘ì¼</label>
        <input type="date" id="startDate">
    </div>
    <div class="filter-group">
        <label for="endDate">ì¢…ë£Œì¼</label>
        <input type="date" id="endDate">
    </div>
    <button class="action-button" onclick="applyMainFilters()" style="padding: 0.5rem 1rem; height: 38px;">
      <i class="fa-solid fa-search" style="margin-right: 4px;"></i> ì¡°íšŒ
    </button>
</div>

  <div id="loader-container">
    <?!= include('loading'); ?>
  </div>

  <div id="dashboard-content" class="initially-hidden">

    <h2 class="section-title">ğŸ“ˆ í•µì‹¬ ì„±ê³¼ (vs ì´ì „ ê¸°ê°„)</h2>
    <div class="kpi-grid">
      <div class="card"><h3>Total GMV</h3><p id="kpi-gmv" class="value">â‚©0</p><p id="kpi-gmv-change" class="change-indicator"></p></div>
      <div class="card"><h3>ê°ë‹¨ê°€ (AOV)</h3><p id="kpi-aov" class="value">â‚©0</p><p id="kpi-aov-change" class="change-indicator"></p></div>
      <div class="card"><h3>ì£¼ë¬¸ ê±´ìˆ˜</h3><p id="kpi-order-count" class="value">0</p><p id="kpi-order-count-change" class="change-indicator"></p></div>
      <div class="card"><h3>íŒë§¤ ì‘í’ˆ ìˆ˜</h3><p id="kpi-item-count" class="value">0</p><p id="kpi-item-count-change" class="change-indicator"></p></div>
    </div>

    <h2 class="section-title">ğŸ“Š GMV & ì£¼ë¬¸ ì¶”ì„¸ (7ì¼ ì´ë™í‰ê· )</h2>
    <div class="card chart-card">
      <canvas id="trendChartCanvas" style="width: 100%; height: 350px;"></canvas>
    </div>

    <h2 class="section-title">ğŸ“Œ ì£¼ìš” í˜„í™© ìš”ì•½</h2>
    <div class="summary-grid">
      <div class="card">
        <h3>ë¯¸ì…ê³  í˜„í™©</h3>
        <div class="inventory-summary">
          <p>ì´ <strong id="inv-total">0</strong> ê±´</p>
          <p class="delay-warning">ğŸš¨ <span id="inv-threshold">7</span>ì¼ ì´ìƒ ì§€ì—°: <strong id="inv-delayed">0</strong> ê±´</p>
        </div>
        <div class="card-footer">
          <a href="<?= ScriptApp.getService().getUrl() ?>?page=start" class="pipeline-link">ë¯¸ì…ê³  ê´€ë¦¬ ë°”ë¡œê°€ê¸° &gt;</a>
        </div>
      </div>

      <div class="card">
        <h3>ì„±ê³¼ ìŠ¤ëƒ…ìƒ· (ì„ íƒ ê¸°ê°„)</h3>
        <div class="snapshot-grid">
          <div><span class="snapshot-icon">ğŸŒ</span><p><strong id="snap-countries">0</strong> ê°œêµ­</p></div>
          <div><span class="snapshot-icon">ğŸ§‘â€ğŸ¨</span><p><strong id="snap-artists">0</strong> ëª…</p></div>
          <div><span class="snapshot-icon">ğŸ¨</span><p><strong id="snap-items">0</strong> ê°œ ìƒí’ˆ</p></div>
        </div>
      </div>
 
      <div class="card placeholder-card">
         <p style="text-align: center; color: var(--text-muted-color); padding: 4rem 0;">ì¶”ê°€ ì •ë³´ ì˜ì—­</p>
       </div>

    </div>
  </div>
</div>

<script>
  // --- Chart.js ì¸ìŠ¤í„´ìŠ¤ ì €ì¥ ---
  let charts = {};

  // --- í˜ì´ì§€ ì´ˆê¸°í™” ---
  document.addEventListener("DOMContentLoaded", function() {
  // ê¸°ë³¸ ë‚ ì§œë¥¼ 'ìµœê·¼ 30ì¼'ë¡œ ì„¤ì •
  const endDateInput = document.getElementById('endDate');
  const startDateInput = document.getElementById('startDate');
  
  const today = new Date();
  // (ì°¸ê³ : 29ì¼ì„ ë¹¼ì•¼ ì˜¤ëŠ˜ í¬í•¨ 30ì¼ì´ ë©ë‹ˆë‹¤)
  const thirtyDaysAgo = new Date(new Date().setDate(today.getDate() - 29)); 
  
  // 'YYYY-MM-DD' í˜•ì‹ìœ¼ë¡œ ë³€í™˜
  const formatDate = (date) => date.toISOString().split('T')[0];
  
  endDateInput.value = formatDate(today);
  startDateInput.value = formatDate(thirtyDaysAgo);

  applyMainFilters(); // ì„¤ì •ëœ ê¸°ë³¸ê°’ìœ¼ë¡œ ë°ì´í„° ë¡œë“œ
});

  // --- í•„í„° ì ìš© ë° ë°ì´í„° ë¡œë“œ ---
  function applyMainFilters() {
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;

  // ìœ íš¨ì„± ê²€ì‚¬
  if (!startDate || !endDate) {
      alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
      return;
  }
  if (startDate > endDate) {
      alert('ì‹œì‘ì¼ì€ ì¢…ë£Œì¼ë³´ë‹¤ ì´ì „ì´ê±°ë‚˜ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.');
      return;
  }

  document.getElementById('loader-container').style.display = 'block';
  document.getElementById('dashboard-content').classList.add('initially-hidden');

  // ê¸°ì¡´ ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ íŒŒê´´
  Object.values(charts).forEach(chart => {
      if (chart && typeof chart.destroy === 'function') {
          chart.destroy();
      }
  });
  charts = {}; // ì´ˆê¸°í™”

  google.script.run
    .withSuccessHandler(updateUI)
    .withFailureHandler(showError)
    .getMainDashboardData(startDate, endDate); // [ìˆ˜ì •] 2ê°œì˜ ë‚ ì§œ ì¸ì ì „ë‹¬
}

  // --- ë°ì´í„° ë Œë”ë§ ---
  function updateUI(data) {
    if (data.error) {
      showError(data.error);
      return;
    }

    // KPI ì—…ë°ì´íŠ¸
    updateMainKpiCard('gmv', data.kpis.gmv.value, data.kpis.gmv.change, 'currency');
    updateMainKpiCard('aov', data.kpis.aov.value, data.kpis.aov.change, 'currency');
    updateMainKpiCard('order-count', data.kpis.orderCount.value, data.kpis.orderCount.change, 'number');
    updateMainKpiCard('item-count', data.kpis.itemCount.value, data.kpis.itemCount.change, 'number');

    // Chart.js ì°¨íŠ¸ ê·¸ë¦¬ê¸°
    drawTrendChart_ChartJS(data.trend); // íŠ¸ë Œë“œ ì°¨íŠ¸ë§Œ í˜¸ì¶œ

    // ë¯¸ì…ê³  í˜„í™© ì—…ë°ì´íŠ¸
    document.getElementById('inv-total').textContent = data.inventoryStatus.total.toLocaleString();
    document.getElementById('inv-delayed').textContent = data.inventoryStatus.delayed.toLocaleString();
    document.getElementById('inv-threshold').textContent = data.inventoryStatus.threshold;
    const delayWarningEl = document.querySelector('.delay-warning');
    if(delayWarningEl) {
       delayWarningEl.style.color = data.inventoryStatus.delayed > 0 ? 'var(--danger-color)' : 'inherit';
       delayWarningEl.style.fontWeight = data.inventoryStatus.delayed > 0 ? 'bold' : 'normal';
    }

    // Performance Snapshot ì—…ë°ì´íŠ¸
    document.getElementById('snap-countries').textContent = data.snapshot.activeCountries.toLocaleString();
    document.getElementById('snap-artists').textContent = data.snapshot.activeArtists.toLocaleString();
    document.getElementById('snap-items').textContent = data.snapshot.activeItems.toLocaleString();
    // ë¡œë” ìˆ¨ê¸°ê³  ì»¨í…ì¸  í‘œì‹œ
    document.getElementById('loader-container').style.display = 'none';
    document.getElementById('dashboard-content').classList.remove('initially-hidden');
  }

  // --- UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
  function updateMainKpiCard(id, value, change, format) {
    const valueEl = document.getElementById(`kpi-${id}`);
    const changeEl = document.getElementById(`kpi-${id}-change`);
    if (valueEl) {
      if (format === 'currency') valueEl.textContent = `â‚©${Math.round(value).toLocaleString()}`;
      else if (format === 'percent') valueEl.textContent = `${(value * 100).toFixed(1)}%`;
      else valueEl.textContent = value.toLocaleString();
    }
    if (changeEl) {
      if (change != null && !isNaN(change) && isFinite(change)) {
        if (change >= 0) { changeEl.innerHTML = `<span class="up">â–²</span> ${(change * 100).toFixed(1)}%`;
          changeEl.className = 'change-indicator up'; }
        else { changeEl.innerHTML = `<span class="down">â–¼</span> ${(Math.abs(change) * 100).toFixed(1)}%`;
          changeEl.className = 'change-indicator down'; }
      } else if (change === Infinity) {
          changeEl.innerHTML = `<span class="up">â–²</span> New`;
          changeEl.className = 'change-indicator up';
      } else {
        changeEl.innerHTML = '';
        changeEl.className = 'change-indicator';
      }
    }
  }

  // --- ìˆ«ì í¬ë§· í—¬í¼ ---
  function formatShortNumber(value) {
      if (value === null || value === undefined) return '-';
      if (value >= 1e9) return (value / 1e9).toFixed(1) + 'B';
      if (value >= 1e6) return (value / 1e6).toFixed(1) + 'M';
      if (value >= 1e3) return (value / 1e3).toFixed(1) + 'K';
      return value < 1000 ? value.toFixed(0) : value.toLocaleString(undefined, {maximumFractionDigits: 0});
  }
   function formatNumber(value) { return value === null || value === undefined ? '-' : value.toLocaleString();}
   function formatCurrency(value) { return value === null || value === undefined ? '-' : 'â‚©' + Math.round(value).toLocaleString();}

  // --- Chart.js ì°¨íŠ¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜ ---

  const chartJsDefaultOptions = {
      responsive: true,
      maintainAspectRatio: false,
      animation: {
          duration: 800,
          easing: 'easeOutQuart'
      },
      plugins: {
          legend: {
              position: 'bottom',
              labels: { font: { family: 'Pretendard', size: 11 }, color: '#555', padding: 15 }
          },
          tooltip: {
              enabled: false, // ì»¤ìŠ¤í…€ íˆ´íŒ ì‚¬ìš© ìœ„í•´ ë¹„í™œì„±í™”
              external: customTooltip
          }
      },
      scales: {
          x: { grid: { display: false }, ticks: { font: { family: 'Pretendard', size: 11 }, color: '#555' } },
          y: { grid: { color: '#eee' }, ticks: { font: { family: 'Pretendard', size: 11 }, color: '#555' }, beginAtZero: true }
      },
      layout: { padding: { top: 10, right: 20, bottom: 0, left: 10 } }
  };
  /**
   * Chart.js - GMV & ì£¼ë¬¸ íŠ¸ë Œë“œ ì½¤ë³´ ì°¨íŠ¸ (ê°œì„  ì ìš©)
   */
  function drawTrendChart_ChartJS(chartData) {
      const canvasId = 'trendChartCanvas';
      const ctx = document.getElementById(canvasId);
      // ìº”ë²„ìŠ¤ ìš”ì†Œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
      if (!ctx) {
          console.error('Canvas element not found:', canvasId);
          return;
      }
      // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
      if (!chartData || !chartData.labels || chartData.labels.length === 0) {
          const parent = ctx.parentNode;
          if (parent) {
              // ë°ì´í„° ì—†ì„ ì‹œ ë©”ì‹œì§€ í‘œì‹œ
              parent.innerHTML = '<p class="no-data-message">ì¶”ì„¸ ë°ì´í„° ì—†ìŒ</p>';
          }
          // ì´ì „ ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆìœ¼ë©´ íŒŒê´´
          if (charts[canvasId] && typeof charts[canvasId].destroy === 'function') {
              charts[canvasId].destroy();
              delete charts[canvasId]; // ì°¸ì¡° ì œê±°
          }
          return;
      }
      // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ íŒŒê´´ (ì¬ìƒì„± ìœ„í•¨)
      if (charts[canvasId] && typeof charts[canvasId].destroy === 'function') {
           charts[canvasId].destroy();
      }

      // ê·¸ë¼ë°ì´ì…˜ ìƒì„± í•¨ìˆ˜
      function createGradient(context, color1, color2) {
          const chart = context.chart;
          const {ctx, chartArea} = chart;
          if (!chartArea) { // chartAreaê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŒ
              return null;
          }
          const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
          gradient.addColorStop(0, color2); // ì•„ë˜ìª½ (íˆ¬ëª…ë„ ë†’ê²Œ)
          gradient.addColorStop(1, color1); // ìœ„ìª½ (íˆ¬ëª…ë„ ë‚®ê²Œ)
          return gradient;
      }

      // Chart.js ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì €ì¥
      charts[canvasId] = new Chart(ctx, {
          // data ê°ì²´ëŠ” ë°±ì—”ë“œì—ì„œ ì „ë‹¬ëœ chartDataë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
          data: chartData,
          options: {
              ...chartJsDefaultOptions, // ê¸°ë³¸ ì˜µì…˜ ìƒì†
              plugins: {
                  ...chartJsDefaultOptions.plugins, // ê¸°ë³¸ í”ŒëŸ¬ê·¸ì¸ ì˜µì…˜ ìƒì†
                  tooltip: { // ì»¤ìŠ¤í…€ HTML íˆ´íŒ ì‚¬ìš© ì„¤ì •
                      enabled: false, // Chart.js ê¸°ë³¸ íˆ´íŒ ë¹„í™œì„±í™”
                      external: customTooltip // ì»¤ìŠ¤í…€ íˆ´íŒ ì½œë°± í•¨ìˆ˜ ì§€ì •
                  }
              },
              scales: {
                  x: { // Xì¶• (ì‹œê°„ ì¶•) ì„¤ì •
                     type: 'time', // ì‹œê°„ íƒ€ì… ì¶• ì‚¬ìš©
                     time: {
                         unit: 'day', // ê¸°ë³¸ ë‹¨ìœ„ 'ì¼'
                         tooltipFormat: 'll', // Moment.js ë¡œì¼€ì¼ ë‚ ì§œ í˜•ì‹ (ì˜ˆ: Oct 24, 2025)
                         displayFormats: { day: 'M/D' } // ì¶• ë ˆì´ë¸” í˜•ì‹ (ì˜ˆ: 10/24)
                     },
                     grid: { display: false }, // Xì¶• ê·¸ë¦¬ë“œ ë¼ì¸ ìˆ¨ê¹€
                     ticks: {
                         ...chartJsDefaultOptions.scales.x.ticks, // ê¸°ë³¸ í‹± ì˜µì…˜ ìƒì†
                         source: 'auto', // ë°ì´í„° ê¸°ë°˜ ìë™ í‹± ìƒì„±
                         maxRotation: 0, // ë ˆì´ë¸” íšŒì „ ì—†ìŒ
                         autoSkip: true, // ê³µê°„ ë¶€ì¡± ì‹œ ìë™ ê±´ë„ˆë›°ê¸°
                         autoSkipPadding: 30 // ê±´ë„ˆë›°ê¸° ì‹œ ìµœì†Œ ì—¬ë°±
                     }
                  },
                  yGmv: { // ì™¼ìª½ Yì¶• (GMV)
                      type: 'linear', // ì„ í˜• ì¶•
                      position: 'left', // ì™¼ìª½ì— ìœ„ì¹˜
                      grid: { color: '#eee' }, // ê·¸ë¦¬ë“œ ë¼ì¸ ìƒ‰ìƒ
                      ticks: {
                          font: { family: 'Pretendard', size: 11 }, // í‹± í°íŠ¸
                          color: '#555', // í‹± ìƒ‰ìƒ
                          // ì§§ì€ ìˆ«ì í˜•ì‹ (K, M, B) ì½œë°±
                          callback: value => formatShortNumber(value)
                      },
                      title: { // ì¶• ì œëª©
                          display: true,
                          text: 'GMV (KRW)',
                          font: { family: 'Pretendard', size: 12 },
                          color: '#333'
                      },
                      beginAtZero: true // 0ë¶€í„° ì‹œì‘
                  },
                  yOrders: { // ì˜¤ë¥¸ìª½ Yì¶• (Orders)
                     type: 'linear', // ì„ í˜• ì¶•
                      position: 'right', // ì˜¤ë¥¸ìª½ì— ìœ„ì¹˜
                      grid: { drawOnChartArea: false }, // ì°¨íŠ¸ ì˜ì—­ ë‚´ ê·¸ë¦¬ë“œ ë¼ì¸ ê·¸ë¦¬ì§€ ì•ŠìŒ (ì¤‘ë³µ ë°©ì§€)
                      title: { // ì¶• ì œëª©
                          display: true,
                          text: 'ì£¼ë¬¸ ê±´ìˆ˜',
                          font: { family: 'Pretendard', size: 12 },
                          color: '#333'
                      },
                      ticks: {
                          font: { family: 'Pretendard', size: 11 }, // í‹± í°íŠ¸
                          color: '#F79F79', // í‹± ìƒ‰ìƒ (Orders ì„  ìƒ‰ìƒê³¼ ì¼ì¹˜)
                          stepSize: 5,      // ëˆˆê¸ˆ ê°„ê²©ì„ 5ë¡œ ì„¤ì •
                          precision: 0      // ì†Œìˆ˜ì  ì—†ì´ ì •ìˆ˜ë¡œ í‘œì‹œ
                          // callback: value => formatNumber(value) // stepSize ì‚¬ìš© ì‹œ ë¶ˆí•„ìš”
                      },
                      beginAtZero: true // 0ë¶€í„° ì‹œì‘
                  }
              },
              interaction: { // ë§ˆìš°ìŠ¤ ìƒí˜¸ì‘ìš© ì„¤ì •
                  mode: 'index', // ë™ì¼í•œ ì¸ë±ìŠ¤(ë‚ ì§œ)ì˜ ëª¨ë“  ë°ì´í„°ì…‹ ì•„ì´í…œì„ ì°¾ìŒ
                  intersect: false // ë§ˆìš°ìŠ¤ í¬ì¸í„°ê°€ ì •í™•íˆ ìš”ì†Œ ìœ„ì— ìˆì§€ ì•Šì•„ë„ ìƒí˜¸ì‘ìš©
               },
              layout: { // ì°¨íŠ¸ ì „ì²´ ì—¬ë°± ì„¤ì •
                  padding: { top: 10, right: 15, bottom: 0, left: 5 } // Yì¶• ì œëª©/ë¼ë²¨ ê³µê°„ ê³ ë ¤
              }
          }
      });
  }

  // --- ì»¤ìŠ¤í…€ íˆ´íŒ ì½œë°± í•¨ìˆ˜ ---
  function customTooltip(context) {
        let tooltipEl = document.getElementById('chartjs-tooltip');
        // Create element on first render
        if (!tooltipEl) {
            tooltipEl = document.createElement('div');
            tooltipEl.id = 'chartjs-tooltip';
            // [ê°œì„ ] ìŠ¤íƒ€ì¼ì€ chart_styles.txtì—ì„œ ê´€ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œ ì œê±°
            // tooltipEl.style.opacity = 0;
            // ... (ê¸°ì¡´ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±°) ...
            document.body.appendChild(tooltipEl);
        }

        const tooltipModel = context.tooltip;
        // Hide if no tooltip
        if (tooltipModel.opacity === 0) {
            tooltipEl.style.opacity = 0;
            return;
        }

        // Set caret Position (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        tooltipEl.classList.remove('above', 'below', 'no-transform');
        tooltipEl.classList.add(tooltipModel.yAlign || 'no-transform');

        // Set Text
        if (tooltipModel.body) {
            const titleLines = tooltipModel.title || [];
            const dataPoints = tooltipModel.dataPoints || [];

            let innerHtml = '';
            // Title (Date)
            titleLines.forEach(function(title) {
                innerHtml += '<strong>' + moment(title).format('YYYY-MM-DD (ddd)') + '</strong><br>'; // ìš”ì¼ ì •ë³´ ì¶”ê°€
            });
            // Body
            const gmv = dataPoints.find(dp => dp.datasetIndex === 0)?.raw;
            const orders = dataPoints.find(dp => dp.datasetIndex === 1)?.raw;
            const gmvMA = dataPoints.find(dp => dp.datasetIndex === 2)?.raw;
            const ordersMA = dataPoints.find(dp => dp.datasetIndex === 3)?.raw;

            innerHtml += `GMV: <strong>${formatCurrency(gmv)}</strong><br>`;
            innerHtml += `Orders: <strong>${formatNumber(orders)}</strong><br>`;
            innerHtml += '<hr style="border: 0; border-top: 1px solid #eee; margin: 4px 0;">';
            innerHtml += `GMV MA(7): ${formatCurrency(gmvMA)}<br>`;
            innerHtml += `Orders MA(7): ${formatNumber(ordersMA)}`;

            tooltipEl.innerHTML = innerHtml;
        }

        // Display, position, and set styles for font (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        const position = context.chart.canvas.getBoundingClientRect();
        tooltipEl.style.opacity = 1;
        let left = position.left + window.pageXOffset + tooltipModel.caretX;
        let top = position.top + window.pageYOffset + tooltipModel.caretY;
        // Prevent tooltip going out of bounds
         if (left + tooltipEl.offsetWidth > window.innerWidth - 10) {
           left = window.innerWidth - tooltipEl.offsetWidth - 10;
         }
         if (left < 10) {
           left = 10;
         }
        if (tooltipModel.yAlign === 'above' || top + tooltipEl.offsetHeight > window.innerHeight - 10) {
          top -= tooltipEl.offsetHeight + 10; // Position above cursor
        } else {
          top += 10; // Position below cursor
        }
         if (top < 10) {
           top = 10;
         }

        tooltipEl.style.left = left + 'px';
        tooltipEl.style.top = top + 'px';
  }

  // --- ì—ëŸ¬ ì²˜ë¦¬ í•¨ìˆ˜ ---
  function showError(error) {
    console.error('Error:', error);
    const content = document.getElementById('dashboard-content');
    const loader = document.getElementById('loader-container');
    if(loader) loader.style.display = 'none';
    if (content) {
        content.classList.remove('initially-hidden');
        // ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë” ëˆˆì— ë„ê²Œ í‘œì‹œ (card error-card í™œìš©)
        content.innerHTML = `<div class="card error-card">
                              <h3><span style="color:var(--danger-color); margin-right: 0.5em;">âš ï¸</span>ì˜¤ë¥˜ ë°œìƒ</h3>
                              <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                              <p class="error-details">${error.toString()}</p>
                             </div>`;
    } else if (loader) {
        // ë¡œë” ì˜ì—­ì— ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ (ì»¨í…ì¸  ì˜ì—­ ë¡œë“œ ì‹¤íŒ¨ ì‹œ)
        loader.innerHTML = `<p class="error-message">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ${error.toString()}</p>`;
    }
  }
</script>

<style>
  /* ê¸°ë³¸ ì„¹ì…˜ ì œëª© */
  .section-title { margin-top: 2rem; margin-bottom: 1rem; font-size: 1.5rem; color: var(--text-color);
    border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; }
  /* KPI ì¹´ë“œ ì¶”ì„¸ */
  .change-indicator { font-size: 0.9rem; margin-top: 0.25rem;
    color: var(--text-muted-color); }
  .change-indicator .up { color: var(--success-color); }
  .change-indicator .down { color: var(--danger-color);
  }
  .change-indicator span { margin-right: 0.2em; }
  /* í˜„í™© ìš”ì•½ ê·¸ë¦¬ë“œ */
  .summary-grid { display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
  /* ì¹´ë“œ í‘¸í„° */
  .card-footer { margin-top: auto; padding-top: 1rem;
    text-align: right; border-top: 1px solid var(--border-color); }
  .card .card-footer { margin-left: -1.5rem; margin-right: -1.5rem; padding-right: 1.5rem;
  } /* ê¸°ë³¸ ì¹´ë“œ íŒ¨ë”©(24px) ê³ ë ¤ */
  .pipeline-link { color: var(--primary-color); text-decoration: none; font-weight: 500;
  }
  .pipeline-link:hover { text-decoration: underline; }
  /* ì°¨íŠ¸ ê´€ë ¨ ë©”ì‹œì§€ */
  .no-data-message { text-align: center; color: var(--text-muted-color);
    padding: 2rem; }
  .no-data-message.error, .error-message { color: var(--danger-color); font-weight: bold;
  }
  /* ì˜¤ë¥˜ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
   .error-card { border-left: 5px solid var(--danger-color); padding: 1.5rem; background-color: #fff8f8;
   }
   .error-card h3 { color: var(--danger-color); margin-top: 0; }
   .error-details { font-size: 0.9em; color: var(--text-muted-color);
    margin-top: 1em; word-break: break-all; }
   
   /* [ì‚­ì œ] #chartjs-tooltip ìŠ¤íƒ€ì¼ ì œê±° (chart_styles.txtì—ì„œ ê´€ë¦¬) */
   
   /* ì°¨íŠ¸ ì¹´ë“œ íŒ¨ë”© ì¡°ì • */
   .card.chart-card { padding: 0.5rem;
   } /* component_styles.txtì—ì„œ ìˆ˜ì • ê°€ëŠ¥ */
</style>

<style>
  /* index.html í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
  .inventory-summary { padding: 1rem 0;
  }
  .inventory-summary p { margin: 0.5rem 0; font-size: 1.1rem; }
  .inventory-summary strong { font-size: 1.8rem; color: var(--text-color);
  }
  .delay-warning { font-size: 1rem !important; }
  .delay-warning strong { font-size: 1.3rem !important; color: var(--danger-color);
  }

  .snapshot-grid { display: flex; justify-content: space-around; align-items: center; text-align: center; padding: 1rem 0;
  }
  .snapshot-grid div { display: flex; flex-direction: column; align-items: center; }
  .snapshot-icon { font-size: 2.5rem; margin-bottom: 0.5rem;
    color: var(--primary-color); }
  .snapshot-grid p { margin: 0; font-size: 1rem; color: var(--text-muted-color); }
  .snapshot-grid strong { font-size: 1.8rem;
    display: block; color: var(--text-color); }

  .placeholder-card {
     display: flex; align-items: center; justify-content: center; min-height: 250px;
     background-color: var(--background-alt-color); border: 1px dashed var(--border-color);
   }

   /* ë¯¸ì…ê³  ê´€ë¦¬ KPI ê´€ë ¨ ìŠ¤íƒ€ì¼ (start.htmlë¡œ ì´ë™ ê¶Œì¥í•˜ë‚˜, ì—¬ê¸° ìˆì–´ë„ ë¬´ë°©) */
   #kpi-total small, #kpi-orders small, #kpi-artists small, #kpi-delayed small {
     font-size: 0.7em;
     color: var(--text-muted-color);
     margin-left: 0.2em;
   }
   #kpi-delayed.warning {
       color: var(--warning-color);
   }
</style>