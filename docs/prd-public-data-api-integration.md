# 공공 데이터 API 연동 기획안

## 📋 문서 정보
- **작성일**: 2024-12-10
- **버전**: 1.0
- **목적**: Global Business Hub의 분석 기능 강화를 위한 공공 데이터 API 연동 전략

---

## 1. 현재 허브 기능 진단

### 1.1 핵심 데이터 구조

| 데이터 시트 | 주요 필드 | 활용 기능 |
|------------|----------|----------|
| **order** | order_code, order_created, user_id, Total GMV, country, platform | 대시보드 KPI, 매출 분석 |
| **logistics** | shipment_id, country, logistics_status, 국제송장번호 | 물류 추적, 배송 현황 |
| **users** | ID, NAME, EMAIL, COUNTRY, CREATED_AT | 고객 분석, RFM 세그먼트 |
| **artists** | 작가명, Live 작품수, artist_id, 등록일 | 작가 분석, 성과 추적 |
| **settlement_records** | period, carrier, country, weight, actual_cost | 물류비 정산, 비용 분석 |
| **review** | rating, review_text, country | 리뷰 분석, 고객 만족도 |

### 1.2 현재 기능별 데이터 활용 현황

#### 📊 대시보드 (Dashboard)
- **현재**: GMV, 주문 건수, AOV, 국가별 매출
- **한계**: 외부 시장 트렌드, 경쟁 환경 정보 부재

#### 🚚 물류 관리 (Logistics/Settlement)
- **현재**: 배송 상태, 운송비 정산, 국가별 비용 분석
- **한계**: 실시간 환율, 국제 유가, 항공/해운 운임 지수 미반영

#### 👥 고객 분석 (Customer Analytics)
- **현재**: RFM 세그먼트, 이탈 예측, 코호트 분석
- **한계**: 국가별 경제 지표, 소비자 신뢰 지수 미반영

#### 🎨 작가 분석 (Artist Analytics)
- **현재**: 작가별 매출, 작품 성과, 건강 점수
- **한계**: 카테고리별 시장 트렌드, 계절성 분석 미흡

#### 📅 마케팅 (Marketer/Coupon)
- **현재**: 캠페인 관리, 쿠폰 생성
- **한계**: 글로벌 기념일 자동 연동, 시장별 이벤트 캘린더 미흡

---

## 2. 공공 데이터 API 연동 제안

### 2.1 데이터 취득 난이도별 분류

#### 🟢 쉬움 (무료 API, 인증 간단)

| API | 제공 기관 | 데이터 | 활용 방안 |
|-----|----------|--------|----------|
| **한국수출입은행 환율 API** | 한국수출입은행 | 실시간 환율 (USD, JPY, EUR 등) | 물류비 환산, 매출 환율 적용 |
| **공공데이터포털 휴일 API** | 행정안전부 | 한국 공휴일 | 마케팅 캘린더, 배송 예상일 |
| **기상청 날씨 API** | 기상청 | 날씨 정보 | 계절성 분석, 배송 지연 예측 |

#### 🟡 보통 (API 키 발급 필요, 일일 호출 제한)

| API | 제공 기관 | 데이터 | 활용 방안 |
|-----|----------|--------|----------|
| **KOSIS 통계 API** | 통계청 | 소비자물가지수, 경제지표 | 시장 트렌드 분석 |
| **관세청 수출입 통계** | 관세청 | 품목별 수출입 현황 | 카테고리별 시장 규모 |
| **한국은행 경제통계** | 한국은행 | GDP, 소비자심리지수 | 거시경제 분석 |

#### 🔴 어려움 (유료 또는 복잡한 인증)

| API | 제공 기관 | 데이터 | 활용 방안 |
|-----|----------|--------|----------|
| **국제 유가 API** | EIA (미국) | WTI, 브렌트유 가격 | 물류비 예측 |
| **항공 운임 지수** | IATA | 항공 화물 운임 | 항공 물류비 분석 |
| **글로벌 이커머스 트렌드** | Statista | 시장 규모, 성장률 | 전략 수립 |

---

### 2.2 우선순위 선정 (ROI 기반)

```
우선순위 = (비즈니스 임팩트 × 활용 빈도) / (구현 난이도 × 비용)
```

| 순위 | API | 임팩트 | 빈도 | 난이도 | 점수 |
|------|-----|--------|------|--------|------|
| 1 | 환율 API | ⭐⭐⭐⭐⭐ | 매일 | 낮음 | **95** |
| 2 | 휴일 API | ⭐⭐⭐⭐ | 매일 | 낮음 | **85** |
| 3 | 소비자물가지수 | ⭐⭐⭐⭐ | 월간 | 보통 | **70** |
| 4 | 수출입 통계 | ⭐⭐⭐ | 월간 | 보통 | **60** |
| 5 | 국제 유가 | ⭐⭐⭐ | 주간 | 높음 | **45** |

---

## 3. 1단계 구현: 환율 API 연동

### 3.1 한국수출입은행 환율 API

**API 정보**
- URL: `https://www.koreaexim.go.kr/site/program/financial/exchangeJSON`
- 인증: API 키 (무료 발급)
- 호출 제한: 일 1,000회
- 응답 형식: JSON

**요청 파라미터**
```
authkey: API 인증키
searchdate: 조회일자 (YYYYMMDD)
data: AP01 (환율)
```

**응답 예시**
```json
[
  {
    "result": 1,
    "cur_unit": "USD",
    "cur_nm": "미국 달러",
    "ttb": "1,350.50",
    "tts": "1,377.50",
    "deal_bas_r": "1,364.00",
    "bkpr": "1,364",
    "yy_efee_r": "0.00",
    "ten_dd_efee_r": "0.00",
    "kftc_deal_bas_r": "1,364.00",
    "kftc_bkpr": "1,364"
  }
]
```

### 3.2 백엔드 구현 설계

**파일 구조**
```
backend/src/
├── services/
│   └── external/
│       ├── ExchangeRateService.ts    # 환율 API 서비스
│       ├── HolidayService.ts         # 휴일 API 서비스
│       └── index.ts
├── routes/
│   └── external-data.ts              # 외부 데이터 API 라우트
└── config/
    └── externalApis.ts               # API 키 및 설정
```

**ExchangeRateService.ts 설계**
```typescript
interface ExchangeRate {
  currency: string;      // 통화 코드 (USD, JPY, EUR)
  currencyName: string;  // 통화명
  buyRate: number;       // 매입 환율
  sellRate: number;      // 매도 환율
  baseRate: number;      // 기준 환율
  date: string;          // 조회일
}

class ExchangeRateService {
  // 실시간 환율 조회
  async getCurrentRates(): Promise<ExchangeRate[]>
  
  // 특정 통화 환율 조회
  async getRate(currency: string): Promise<ExchangeRate>
  
  // 환율 변환
  async convert(amount: number, from: string, to: string): Promise<number>
  
  // 캐싱 (1시간 유효)
  private cache: Map<string, { data: ExchangeRate[], timestamp: number }>
}
```

### 3.3 프론트엔드 활용 방안

#### 대시보드 환율 위젯
```
┌─────────────────────────────────────┐
│ 💱 실시간 환율                      │
├─────────────────────────────────────┤
│ USD  $1 = ₩1,364.00  ▲ +5.50       │
│ JPY  ¥100 = ₩912.50  ▼ -2.30       │
│ EUR  €1 = ₩1,485.00  ▲ +8.20       │
├─────────────────────────────────────┤
│ 마지막 업데이트: 2024-12-10 09:00   │
└─────────────────────────────────────┘
```

#### 물류비 정산 환율 적용
- 정산서 업로드 시 해당 기간 평균 환율 자동 적용
- 국가별 물류비를 원화로 환산하여 비교 분석

#### Business Brain 연동
- "이번 달 엔화 환율 변동이 일본 매출에 미친 영향은?"
- "환율 상승 시 물류비 증가 예상치는?"

---

## 4. 2단계 구현: 휴일 API 연동

### 4.1 공공데이터포털 휴일 API

**API 정보**
- URL: `http://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService`
- 인증: 공공데이터포털 API 키
- 호출 제한: 일 1,000회

**활용 방안**

#### 마케팅 캘린더 자동화
```
┌─────────────────────────────────────┐
│ 📅 12월 마케팅 캘린더               │
├─────────────────────────────────────┤
│ 25일 (수) 🎄 크리스마스 - 공휴일    │
│   → 추천: 크리스마스 프로모션       │
│   → 배송 마감: 12/20               │
├─────────────────────────────────────┤
│ 31일 (화) 🎆 연말                   │
│   → 추천: 연말 감사 쿠폰            │
└─────────────────────────────────────┘
```

#### 배송 예상일 계산
- 휴일 제외한 실제 영업일 기준 배송일 계산
- 국가별 휴일 고려한 국제 배송 예상

---

## 5. 3단계 구현: 경제 지표 연동

### 5.1 KOSIS 통계 API

**활용 데이터**
- 소비자물가지수 (CPI)
- 소비자심리지수 (CSI)
- 온라인쇼핑 동향

**Business Brain 연동 예시**
```
Q: "최근 소비 트렌드가 우리 매출에 어떤 영향을 주고 있나요?"

A: 📊 소비 트렌드 분석

1. 거시경제 지표
   - 소비자심리지수: 98.5 (전월 대비 -2.3)
   - 온라인쇼핑 성장률: +12.5% YoY

2. 허브 매출 상관관계
   - CSI와 GMV 상관계수: 0.72 (강한 양의 상관)
   - 온라인쇼핑 성장률과 주문 건수: 0.85

3. 인사이트
   - 소비심리 하락에도 불구하고 온라인 채널 선호 증가
   - 프리미엄 핸드메이드 제품 수요는 상대적으로 안정적
```

---

## 6. 기술 구현 상세

### 6.1 아키텍처

```
┌─────────────────────────────────────────────────────────┐
│                    Frontend (Next.js)                    │
├─────────────────────────────────────────────────────────┤
│  Dashboard  │  Settlement  │  Business Brain  │  ...    │
└──────┬──────┴──────┬───────┴────────┬─────────┴─────────┘
       │             │                │
       ▼             ▼                ▼
┌─────────────────────────────────────────────────────────┐
│                    Backend (Express)                     │
├─────────────────────────────────────────────────────────┤
│  /api/external/exchange-rate                            │
│  /api/external/holidays                                 │
│  /api/external/economic-indicators                      │
└──────┬──────────────────────────────────────────────────┘
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│              External API Services                       │
├─────────────────────────────────────────────────────────┤
│  ExchangeRateService  │  HolidayService  │  KosisService │
│  (캐싱: 1시간)        │  (캐싱: 24시간)  │  (캐싱: 1일)  │
└──────┬────────────────┴────────┬─────────┴───────┬──────┘
       │                         │                 │
       ▼                         ▼                 ▼
┌──────────────┐  ┌──────────────────┐  ┌─────────────────┐
│ 한국수출입은행 │  │ 공공데이터포털    │  │ 통계청 KOSIS    │
│ 환율 API      │  │ 휴일 API         │  │ 통계 API        │
└──────────────┘  └──────────────────┘  └─────────────────┘
```

### 6.2 캐싱 전략

| 데이터 | 캐시 TTL | 갱신 주기 | 이유 |
|--------|----------|----------|------|
| 환율 | 1시간 | 매 시간 | 실시간성 중요 |
| 휴일 | 24시간 | 매일 | 변동 적음 |
| 경제지표 | 1일 | 매일 | 월간/분기 발표 |

### 6.3 에러 처리

```typescript
// 외부 API 장애 시 폴백 전략
class ExternalApiService {
  async fetchWithFallback<T>(
    primaryFetch: () => Promise<T>,
    fallbackData: T,
    cacheKey: string
  ): Promise<T> {
    try {
      const data = await primaryFetch();
      this.cache.set(cacheKey, data);
      return data;
    } catch (error) {
      console.error(`[ExternalAPI] 조회 실패, 캐시 사용:`, error);
      // 캐시된 데이터 반환
      const cached = this.cache.get(cacheKey);
      if (cached) return cached;
      // 캐시도 없으면 기본값 반환
      return fallbackData;
    }
  }
}
```

---

## 7. 구현 로드맵

### Phase 1: 환율 API (1주)
- [ ] 한국수출입은행 API 키 발급
- [ ] ExchangeRateService 구현
- [ ] 대시보드 환율 위젯 추가
- [ ] 물류비 정산 환율 적용

### Phase 2: 휴일 API (1주)
- [ ] 공공데이터포털 API 키 발급
- [ ] HolidayService 구현
- [ ] 마케팅 캘린더 연동
- [ ] 배송 예상일 계산 개선

### Phase 3: 경제 지표 (2주)
- [ ] KOSIS API 연동
- [ ] 경제 지표 대시보드 추가
- [ ] Business Brain 연동

### Phase 4: 고도화 (지속)
- [ ] 글로벌 휴일 API 연동 (각국 휴일)
- [ ] 국제 유가 API 연동
- [ ] 예측 모델 개발

---

## 8. 예상 효과

### 8.1 정량적 효과

| 지표 | 현재 | 목표 | 개선율 |
|------|------|------|--------|
| 환율 적용 정확도 | 수동 입력 | 실시간 자동 | 100% |
| 마케팅 캘린더 자동화 | 0% | 80% | +80%p |
| 배송 예상일 정확도 | 70% | 90% | +20%p |
| 분석 인사이트 깊이 | 내부 데이터만 | 외부 지표 연동 | 질적 향상 |

### 8.2 정성적 효과

- **의사결정 품질 향상**: 외부 환경 변수를 고려한 분석
- **운영 효율성**: 수동 데이터 입력 제거
- **예측 정확도**: 거시경제 지표 기반 트렌드 예측
- **사용자 경험**: 더 풍부한 인사이트 제공

---

## 9. 리스크 및 대응

| 리스크 | 영향 | 대응 방안 |
|--------|------|----------|
| API 서비스 중단 | 높음 | 캐싱 + 폴백 데이터 |
| 호출 제한 초과 | 중간 | 캐싱 최적화, 배치 처리 |
| 데이터 형식 변경 | 중간 | 버전 관리, 어댑터 패턴 |
| API 키 노출 | 높음 | 환경 변수, 서버사이드 호출 |

---

## 10. 결론

공공 데이터 API 연동을 통해 Global Business Hub는:

1. **실시간 환율 정보**로 정확한 물류비 분석
2. **휴일 정보**로 마케팅 자동화 및 배송 예측 개선
3. **경제 지표**로 시장 트렌드 기반 인사이트 제공

단계적 구현을 통해 리스크를 최소화하면서 허브의 분석 역량을 크게 강화할 수 있습니다.

---

*문서 끝*
