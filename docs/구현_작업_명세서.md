# ğŸ“‹ Global Business Hub ê³ ë„í™” êµ¬í˜„ ì‘ì—… ëª…ì„¸ì„œ

> **ë¬¸ì„œ ë²„ì „**: 1.2  
> **ì‘ì„±ì¼**: 2024-12-17  
> **ìµœì¢… ìˆ˜ì •**: 2024-12-17 (Phase 5 ì™„ë£Œ)  
> **ëª©ì **: Phaseë³„ êµ¬í˜„ ì‘ì—…ì˜ ìƒì„¸ ëª…ì„¸ ë° ì²´í¬ë¦¬ìŠ¤íŠ¸  
> **ì°¸ì¡° ë¬¸ì„œ**: `í—ˆë¸Œ_ê°œì„ _ì œì•ˆì„œ.md`, `ë°ì´í„°_ê·œì¹™_ê°€ì´ë“œ.md`  
> **ì‚¬ìš© ë°©ë²•**: ê° íƒœìŠ¤í¬ ì™„ë£Œ ì‹œ ì²´í¬ë°•ìŠ¤(â˜â†’â˜‘) í‘œì‹œ

---

## âš ï¸ ì¤‘ìš” ìš´ì˜ ì •ë³´

| í•­ëª© | ë‚´ìš© | ë¹„ê³  |
|------|------|------|
| **Raw Data ê°±ì‹  ì‹œì ** | **ë§¤ì¼ 11:00 KST** (ìˆ˜ë™ ì—…ë°ì´íŠ¸) | Google Sheets ë°ì´í„° |
| **ë°°ì¹˜ Job ì‹¤í–‰ ì‹œì ** | **ë§¤ì¼ 12:00 KST** (ì •ì˜¤) | Raw Data ê°±ì‹  í›„ 1ì‹œê°„ ë§ˆì§„ |
| **ìˆ˜ë™ ì§‘ê³„ ì‹¤í–‰** | **ê´€ë¦¬ì UI ë˜ëŠ” API í˜¸ì¶œ** | ì‹¤ì‹œê°„ ë°ì´í„° ë°˜ì˜ í•„ìš” ì‹œ |
| **ì§‘ê³„ ëŒ€ìƒ** | **ì „ì¼(D-1) ë°ì´í„°** | ë‹¹ì¼ ë°ì´í„°ëŠ” ë‹¤ìŒë‚  ì§‘ê³„ |

### ìˆ˜ë™ ì§‘ê³„ íŠ¸ë¦¬ê±° ë°©ì‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ë°ì´í„° ì§‘ê³„ ì‹¤í–‰ ë°©ì‹                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   1. ìë™ ì‹¤í–‰ (ê¸°ë³¸)                                                        â”‚
â”‚      â””â”€ ë§¤ì¼ 12:00 KST cron Job â†’ ì „ì¼(D-1) ë°ì´í„° ì§‘ê³„                      â”‚
â”‚                                                                             â”‚
â”‚   2. ìˆ˜ë™ ì‹¤í–‰ (ì˜¨ë””ë§¨ë“œ)                                                     â”‚
â”‚      â”œâ”€ API: POST /api/admin/trigger-aggregation                            â”‚
â”‚      â”‚       Body: { "date": "2024-12-17", "types": ["metrics", "review"] } â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â””â”€ UI: ê´€ë¦¬ì í˜ì´ì§€ > ë°ì´í„° ê´€ë¦¬ > "ì§‘ê³„ ì‹¤í–‰" ë²„íŠ¼                    â”‚
â”‚             - íŠ¹ì • ë‚ ì§œ ì„ íƒ ê°€ëŠ¥                                            â”‚
â”‚             - ì§‘ê³„ ìœ í˜• ì„ íƒ ê°€ëŠ¥ (ì „ì²´/ì£¼ë¬¸/ë¦¬ë·°/ì¿ í°)                       â”‚
â”‚             - ì‹¤í–‰ ê²°ê³¼ ì‹¤ì‹œê°„ í‘œì‹œ                                          â”‚
â”‚                                                                             â”‚
â”‚   3. CLI ì‹¤í–‰ (ê°œë°œ/ìš´ì˜)                                                    â”‚
â”‚      â””â”€ npm run batch:daily -- --date=2024-12-17                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ëª©ì°¨

1. [ì‘ì—… ê°œìš”](#1-ì‘ì—…-ê°œìš”)
2. [ì‚¬ì „ ì¤€ë¹„ì‚¬í•­](#2-ì‚¬ì „-ì¤€ë¹„ì‚¬í•­)
3. [Phase 1: ë°ì´í„° ê¸°ë°˜ í‘œì¤€í™”](#3-phase-1-ë°ì´í„°-ê¸°ë°˜-í‘œì¤€í™”)
4. [Phase 2: 1ì°¨ ê°€ê³µ ë°ì´í„° êµ¬ì¶•](#4-phase-2-1ì°¨-ê°€ê³µ-ë°ì´í„°-êµ¬ì¶•)
5. [Phase 3: 2ì°¨ ê°€ê³µ ë¶„ì„ ì²´ê³„](#5-phase-3-2ì°¨-ê°€ê³µ-ë¶„ì„-ì²´ê³„)
6. [Phase 4: ë³µí•© ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸](#6-phase-4-ë³µí•©-ë¶„ì„-ë°-ì¸ì‚¬ì´íŠ¸)
7. [Phase 5: ì˜ˆì¸¡Â·ìë™í™” í™•ì¥](#7-phase-5-ì˜ˆì¸¡ìë™í™”-í™•ì¥)
8. [í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸](#8-í…ŒìŠ¤íŠ¸-ì²´í¬ë¦¬ìŠ¤íŠ¸)
9. [ë¶€ë¡: ì½”ë“œ í…œí”Œë¦¿](#9-ë¶€ë¡-ì½”ë“œ-í…œí”Œë¦¿)
10. [ë¶€ë¡: ìš©ì–´ ì •ì˜](#10-ë¶€ë¡-ìš©ì–´-ì •ì˜)

---

## 1. ì‘ì—… ê°œìš”

### 1.1 ì „ì²´ íƒ€ì„ë¼ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           êµ¬í˜„ íƒ€ì„ë¼ì¸                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Week 1-2       Week 3-5       Week 6-9       Week 10-15     Future       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€       â”€â”€â”€â”€â”€â”€â”€â”€       â”€â”€â”€â”€â”€â”€â”€â”€       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€       â”‚
â”‚                                                                             â”‚
â”‚   Phase 1        Phase 2        Phase 3        Phase 4        Phase 5      â”‚
â”‚   ê¸°ë°˜ í‘œì¤€í™”    1ì°¨ ê°€ê³µ       2ì°¨ ê°€ê³µ       ë³µí•© ë¶„ì„      ì˜ˆì¸¡/ìë™í™”   â”‚
â”‚                                                                             â”‚
â”‚   8~10ì‹œê°„       20ì‹œê°„         44ì‹œê°„         72ì‹œê°„         18ì‹œê°„        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Phaseë³„ ì˜ì¡´ ê´€ê³„

```
Phase 1 â”€â”€â”€â”€â”€â”€â–º Phase 2 â”€â”€â”€â”€â”€â”€â–º Phase 3 â”€â”€â”€â”€â”€â”€â–º Phase 4 â”€â”€â”€â”€â”€â”€â–º Phase 5
(ê¸°ë°˜)          (L1 êµ¬ì¶•)       (L2 êµ¬ì¶•)       (í™œìš©)          (í™•ì¥)
   â”‚               â”‚               â”‚               â”‚               â”‚
   â–¼               â–¼               â–¼               â–¼               â–¼
ê³µí†µ ìœ í‹¸       DB ìŠ¤í‚¤ë§ˆ       ë¶„ì„ API       í—ˆë¸Œ í˜ì´ì§€     ì˜ˆì¸¡ êµ¬ì¡°
ìƒìˆ˜ ì •ì˜       ë°°ì¹˜ Job        ë¶„ì„ UI        360Â° ë·°        (ì¤€ë¹„ë§Œ)
```

### 1.3 í•µì‹¬ ê·œì¹™ (ëª¨ë“  Phase ê³µí†µ)

| ê·œì¹™ | ìƒì„¸ | ì°¸ì¡° |
|------|------|------|
| **í™˜ìœ¨** | 1 USD = 1,350 KRW (ê³ ì •) | `config/constants.ts` |
| **ì›í™” í¬ë§·** | `â‚©1,234,567` (ì •ìˆ˜, ì²œë‹¨ìœ„ ì‰¼í‘œ) | `lib/formatters.ts` |
| **Null ì²˜ë¦¬** | `safeNumber()`, `safeString()` ì‚¬ìš© | `lib/safeUtils.ts` |
| **ë‚ ì§œ í¬ë§·** | `YYYY-MM-DD` | API í†µì‹  ì‹œ |
| **íƒ€ì„ì¡´** | Asia/Seoul (KST, UTC+9) | ëª¨ë“  ë‚ ì§œ ì²˜ë¦¬ |

---

## 2. ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### 2.1 ê°œë°œ í™˜ê²½ ì²´í¬ë¦¬ìŠ¤íŠ¸

| # | í•­ëª© | í™•ì¸ | ë¹„ê³  |
|:-:|------|:----:|------|
| â˜ | Node.js 18+ ì„¤ì¹˜ | | `node -v` |
| â˜ | pnpm/npm ì„¤ì¹˜ | | íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € |
| â˜ | PostgreSQL 14+ ì„¤ì¹˜ | | Phase 2ë¶€í„° í•„ìš” |
| â˜ | Git ì„¤ì • ì™„ë£Œ | | ë¸Œëœì¹˜ ì „ëµ í™•ì¸ |
| â˜ | í”„ë¡œì íŠ¸ í´ë¡  | | `global-business-hub` |
| â˜ | í™˜ê²½ ë³€ìˆ˜ ì„¤ì • | | `.env.local` |

### 2.2 í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸

```
global-business-hub/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”œâ”€â”€ control-tower/
â”‚   â”‚   â”œâ”€â”€ reviews/
â”‚   â”‚   â”œâ”€â”€ business-brain/
â”‚   â”‚   â”œâ”€â”€ settlement/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ components/             # ê³µí†µ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ lib/                    # ìœ í‹¸ë¦¬í‹° (Phase 1 ìƒì„±)
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ formatters.ts       # ğŸ†• ìƒì„± ì˜ˆì •
â”‚   â”‚   â””â”€â”€ safeUtils.ts        # ğŸ†• ìƒì„± ì˜ˆì •
â”‚   â””â”€â”€ config/                 # ì„¤ì • (Phase 1 ìƒì„±)
â”‚       â”œâ”€â”€ constants.ts        # ğŸ†• ìƒì„± ì˜ˆì •
â”‚       â””â”€â”€ businessRules.ts    # ğŸ†• ìƒì„± ì˜ˆì •
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ jobs/               # ğŸ†• Phase 2 ìƒì„± ì˜ˆì •
â”‚   â”‚   â””â”€â”€ config/
â”‚   â””â”€â”€ ...
â””â”€â”€ docs/                       # ë¬¸ì„œ
```

### 2.3 ë¸Œëœì¹˜ ì „ëµ

| ë¸Œëœì¹˜ | ìš©ë„ |
|--------|------|
| `main` | í”„ë¡œë•ì…˜ |
| `develop` | ê°œë°œ í†µí•© |
| `feature/phase1-*` | Phase 1 ì‘ì—… |
| `feature/phase2-*` | Phase 2 ì‘ì—… |
| `feature/phase3-*` | Phase 3 ì‘ì—… |
| `feature/phase4-*` | Phase 4 ì‘ì—… |
| `feature/phase5-*` | Phase 5 ì‘ì—… |

---

## 3. Phase 1: ë°ì´í„° ê¸°ë°˜ í‘œì¤€í™”

### 3.1 Phase 1 ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ëª©í‘œ** | Raw Data ì ‘ê·¼ì˜ ì¼ê´€ì„± í™•ë³´ |
| **ê¸°ê°„** | 1~2ì£¼ (8~10ì‹œê°„) |
| **ì„ í–‰ ì¡°ê±´** | ì—†ìŒ (ì²« ë²ˆì§¸ Phase) |
| **ì™„ë£Œ ê¸°ì¤€** | ëª¨ë“  í˜ì´ì§€ê°€ ê³µí†µ ìœ í‹¸ë¦¬í‹° ì‚¬ìš© |

### 3.2 íƒœìŠ¤í¬ ëª©ë¡

#### Task 1.1: ê³µí†µ í¬ë§·íŒ… ìœ í‹¸ë¦¬í‹° ìƒì„±

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 1.1.1 | `formatters.ts` íŒŒì¼ ìƒì„± | `frontend/lib/formatters.ts` | 30ë¶„ | â˜‘ |
| 1.1.2 | `formatCurrency()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 15ë¶„ | â˜‘ |
| 1.1.3 | `formatChange()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 15ë¶„ | â˜‘ |
| 1.1.4 | `toKRW()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 10ë¶„ | â˜‘ |
| 1.1.5 | `formatKRW()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 10ë¶„ | â˜‘ |
| 1.1.6 | `formatUSD()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 10ë¶„ | â˜‘ |
| 1.1.7 | `formatPercent()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 10ë¶„ | â˜‘ |
| 1.1.8 | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± | `frontend/lib/__tests__/formatters.test.ts` | 20ë¶„ | â³ |

**êµ¬í˜„ ëª…ì„¸ - `formatters.ts`**:

```typescript
// frontend/lib/formatters.ts

import { CURRENCY } from '@/config/constants'

/**
 * ì›í™” í¬ë§·íŒ…
 * @param value - ê¸ˆì•¡ (number | string | null | undefined)
 * @param defaultValue - ê¸°ë³¸ê°’ (default: 'â‚©0')
 * @returns í¬ë§·íŒ…ëœ ë¬¸ìì—´ (ì˜ˆ: 'â‚©1,234,567')
 */
export const formatCurrency = (
  value: number | string | null | undefined,
  defaultValue: string = 'â‚©0'
): string => {
  if (value === null || value === undefined) return defaultValue
  
  const numValue = typeof value === 'string' 
    ? parseFloat(value.replace(/[,\sâ‚©]/g, '')) 
    : value
  
  if (isNaN(numValue) || !isFinite(numValue)) return defaultValue
  
  return `â‚©${Math.round(numValue).toLocaleString('ko-KR')}`
}

/**
 * ë³€í™”ìœ¨ í¬ë§·íŒ…
 * @param value - ë³€í™”ìœ¨ (number | null | undefined)
 * @returns í¬ë§·íŒ…ëœ ë¬¸ìì—´ (ì˜ˆ: '+15.0%', '-3.2%')
 */
export const formatChange = (
  value: number | null | undefined
): string => {
  if (value === null || value === undefined || isNaN(value)) return '0.0%'
  const sign = value >= 0 ? '+' : ''
  return `${sign}${value.toFixed(1)}%`
}

/**
 * USD â†’ KRW ë³€í™˜
 * @param usdAmount - USD ê¸ˆì•¡
 * @returns KRW ê¸ˆì•¡ (ì •ìˆ˜)
 */
export const toKRW = (usdAmount: number | null | undefined): number => {
  if (usdAmount === null || usdAmount === undefined || isNaN(usdAmount)) return 0
  return Math.round(usdAmount * CURRENCY.USD_TO_KRW)
}

/**
 * USD â†’ KRW ë³€í™˜ í›„ í¬ë§·íŒ…
 * @param usdAmount - USD ê¸ˆì•¡
 * @returns í¬ë§·íŒ…ëœ KRW ë¬¸ìì—´
 */
export const formatKRW = (usdAmount: number | null | undefined): string => {
  return formatCurrency(toKRW(usdAmount))
}

/**
 * USD í¬ë§·íŒ…
 * @param value - USD ê¸ˆì•¡
 * @returns í¬ë§·íŒ…ëœ ë¬¸ìì—´ (ì˜ˆ: '$1,234.56')
 */
export const formatUSD = (value: number | null | undefined): string => {
  if (value === null || value === undefined || isNaN(value)) return '$0.00'
  return `$${value.toLocaleString('en-US', { 
    minimumFractionDigits: 2, 
    maximumFractionDigits: 2 
  })}`
}

/**
 * í¼ì„¼íŠ¸ í¬ë§·íŒ…
 * @param value - ë¹„ìœ¨ (0~1 ë˜ëŠ” 0~100)
 * @param isRatio - trueë©´ 0~1 ë²”ìœ„, falseë©´ 0~100 ë²”ìœ„
 * @returns í¬ë§·íŒ…ëœ ë¬¸ìì—´ (ì˜ˆ: '15.0%')
 */
export const formatPercent = (
  value: number | null | undefined,
  isRatio: boolean = false
): string => {
  if (value === null || value === undefined || isNaN(value)) return '0.0%'
  const percent = isRatio ? value * 100 : value
  return `${percent.toFixed(1)}%`
}
```

**ê²€ì¦ ê¸°ì¤€**:
- [ ] ëª¨ë“  í•¨ìˆ˜ê°€ `null`, `undefined`, `NaN`, `Infinity` ì²˜ë¦¬
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼ìœ¨ 100%

---

#### Task 1.2: ì•ˆì „ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ìƒì„±

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 1.2.1 | `safeUtils.ts` íŒŒì¼ ìƒì„± | `frontend/lib/safeUtils.ts` | 30ë¶„ | â˜‘ |
| 1.2.2 | `safeNumber()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 10ë¶„ | â˜‘ |
| 1.2.3 | `safeString()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 10ë¶„ | â˜‘ |
| 1.2.4 | `safeDivide()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 10ë¶„ | â˜‘ |
| 1.2.5 | `safeArray()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 10ë¶„ | â˜‘ |
| 1.2.6 | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± | `frontend/lib/__tests__/safeUtils.test.ts` | 20ë¶„ | â³ |

**êµ¬í˜„ ëª…ì„¸ - `safeUtils.ts`**:

```typescript
// frontend/lib/safeUtils.ts

/**
 * ì•ˆì „í•œ ìˆ«ì ë³€í™˜
 * @param value - ë³€í™˜í•  ê°’
 * @param defaultValue - ê¸°ë³¸ê°’ (default: 0)
 * @returns ìˆ«ì ê°’
 */
export const safeNumber = (
  value: unknown,
  defaultValue: number = 0
): number => {
  if (value === null || value === undefined) return defaultValue
  
  const num = typeof value === 'string' 
    ? parseFloat(value.replace(/[,\s]/g, ''))
    : Number(value)
  
  return isNaN(num) || !isFinite(num) ? defaultValue : num
}

/**
 * ì•ˆì „í•œ ë¬¸ìì—´ ë³€í™˜
 * @param value - ë³€í™˜í•  ê°’
 * @param defaultValue - ê¸°ë³¸ê°’ (default: '')
 * @returns ë¬¸ìì—´ ê°’
 */
export const safeString = (
  value: unknown,
  defaultValue: string = ''
): string => {
  if (value === null || value === undefined) return defaultValue
  return String(value)
}

/**
 * ì•ˆì „í•œ ë‚˜ëˆ—ì…ˆ
 * @param numerator - ë¶„ì
 * @param denominator - ë¶„ëª¨
 * @param defaultValue - ë¶„ëª¨ê°€ 0ì¼ ë•Œ ê¸°ë³¸ê°’ (default: 0)
 * @returns ë‚˜ëˆ—ì…ˆ ê²°ê³¼
 */
export const safeDivide = (
  numerator: number,
  denominator: number,
  defaultValue: number = 0
): number => {
  if (denominator === 0 || isNaN(denominator) || !isFinite(denominator)) {
    return defaultValue
  }
  const result = numerator / denominator
  return isNaN(result) || !isFinite(result) ? defaultValue : result
}

/**
 * ì•ˆì „í•œ ë°°ì—´ ë³€í™˜
 * @param value - ë³€í™˜í•  ê°’
 * @returns ë°°ì—´ (null/undefinedë©´ ë¹ˆ ë°°ì—´)
 */
export const safeArray = <T>(value: T[] | null | undefined): T[] => {
  return Array.isArray(value) ? value : []
}
```

---

#### Task 1.3: ìƒìˆ˜ ì •ì˜ íŒŒì¼ ìƒì„±

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 1.3.1 | `config` ë””ë ‰í† ë¦¬ ìƒì„± | `frontend/config/` | 5ë¶„ | â˜‘ |
| 1.3.2 | `constants.ts` íŒŒì¼ ìƒì„± | `frontend/config/constants.ts` | 20ë¶„ | â˜‘ |
| 1.3.3 | `businessRules.ts` íŒŒì¼ ìƒì„± | `frontend/config/businessRules.ts` | 20ë¶„ | â˜‘ |

**êµ¬í˜„ ëª…ì„¸ - `constants.ts`**:

```typescript
// frontend/config/constants.ts

/**
 * í†µí™” ê´€ë ¨ ìƒìˆ˜
 */
export const CURRENCY = {
  USD_TO_KRW: 1350,              // ê³ ì • í™˜ìœ¨
  SYMBOL_KRW: 'â‚©',
  SYMBOL_USD: '$',
  DECIMAL_PLACES_KRW: 0,         // ì›í™”ëŠ” ì†Œìˆ˜ì  ì—†ìŒ
  DECIMAL_PLACES_USD: 2,         // ë‹¬ëŸ¬ëŠ” ì†Œìˆ˜ì  2ìë¦¬
} as const

/**
 * íƒ€ì„ì¡´ ê´€ë ¨ ìƒìˆ˜
 */
export const TIMEZONE = {
  DEFAULT: 'Asia/Seoul',
  OFFSET: 9,                     // UTC+9
} as const

/**
 * API ê´€ë ¨ ìƒìˆ˜
 */
export const API = {
  BASE_URL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001',
  TIMEOUT: 30000,                // 30ì´ˆ
} as const

/**
 * í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ë³¸ê°’
 */
export const PAGINATION = {
  DEFAULT_PAGE: 1,
  DEFAULT_PAGE_SIZE: 20,
  MAX_PAGE_SIZE: 100,
} as const
```

**êµ¬í˜„ ëª…ì„¸ - `businessRules.ts`**:

```typescript
// frontend/config/businessRules.ts

/**
 * ê³ ê° í™œë™ ìƒíƒœ ê¸°ì¤€ (ì¼ ìˆ˜)
 */
export const CUSTOMER_ACTIVITY_THRESHOLDS = {
  ACTIVE_DAYS: 90,               // 90ì¼ ì´ë‚´: Active
  INACTIVE_DAYS: 180,            // 91~180ì¼: Inactive
  CHURN_RISK_DAYS: 181,          // 181ì¼+: Churn Risk
} as const

/**
 * ë¬¼ë¥˜ ìœ„í—˜ ê¸°ì¤€ì¼ (ë‹¨ê³„ë³„)
 */
export const LOGISTICS_CRITICAL_DAYS = {
  unreceived: 7,                 // ë¯¸ì…ê³ 
  artistShipping: 5,             // ì‘ê°€ ë°œì†¡
  awaitingInspection: 2,         // ê²€ìˆ˜ ëŒ€ê¸°
  inspectionComplete: 3,         // ê²€ìˆ˜ ì™„ë£Œ
  internationalShipping: 14,     // í•´ì™¸ ë°°ì†¡
} as const

/**
 * RFM ì„¸ê·¸ë¨¼íŠ¸ ê¸°ì¤€
 */
export const RFM_THRESHOLDS = {
  RECENCY: {
    HIGH: 30,                    // 30ì¼ ì´ë‚´: ìµœê·¼ êµ¬ë§¤
    MEDIUM: 90,                  // 31~90ì¼: ì¤‘ê°„
    LOW: 91,                     // 91ì¼+: ì˜¤ë˜ë¨
  },
  FREQUENCY: {
    HIGH: 5,                     // 5íšŒ ì´ìƒ: ê³ ë¹ˆë„
    MEDIUM: 2,                   // 2~4íšŒ: ì¤‘ê°„
    LOW: 1,                      // 1íšŒ: ì €ë¹ˆë„
  },
  MONETARY: {
    HIGH: 500000,                // 50ë§Œì› ì´ìƒ: ê³ ì•¡
    MEDIUM: 100000,              // 10~50ë§Œì›: ì¤‘ê°„
    LOW: 0,                      // 10ë§Œì› ë¯¸ë§Œ: ì €ì•¡
  },
} as const

/**
 * NPS ê³„ì‚° ê¸°ì¤€ (5ì  ë§Œì  ê¸°ì¤€)
 */
export const NPS_THRESHOLDS = {
  PROMOTER_MIN: 5,               // 5ì : Promoter
  PASSIVE_MIN: 4,                // 4ì : Passive
  DETRACTOR_MAX: 3,              // 1~3ì : Detractor
} as const

/**
 * ì¿ í° ë¶„ì„ ê¸°ì¤€
 */
export const COUPON_THRESHOLDS = {
  LOW_CONVERSION_RATE: 0.01,     // 1% ë¯¸ë§Œ: ì €ì „í™˜
  HIGH_ROI: 10,                  // ROI 10x ì´ìƒ: ê³ íš¨ìœ¨
} as const
```

---

#### Task 1.4: ê¸°ì¡´ í˜ì´ì§€ ì¤‘ë³µ í•¨ìˆ˜ ì œê±°

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 1.4.1 | Dashboard ì¤‘ë³µ í•¨ìˆ˜ ì œê±° | `frontend/app/dashboard/page.tsx` | 30ë¶„ | â˜‘ |
| 1.4.2 | Analytics ì¤‘ë³µ í•¨ìˆ˜ ì œê±° | `frontend/app/analytics/page.tsx` | 30ë¶„ | â˜‘ |
| 1.4.3 | Settlement ì¤‘ë³µ í•¨ìˆ˜ ì œê±° | `frontend/app/settlement/page.tsx` | 20ë¶„ | â˜‘ |
| 1.4.4 | Business Brain í™˜ìœ¨ ì¤‘ì•™í™” | `frontend/app/business-brain/page.tsx` | 20ë¶„ | â˜‘ |
| 1.4.5 | Control Tower ìƒìˆ˜ ë¶„ë¦¬ | `frontend/app/control-tower/page.tsx` | 20ë¶„ | â˜‘ |

**ì‘ì—… ìƒì„¸ - Dashboard**:

```typescript
// âŒ ì‚­ì œí•  ì½”ë“œ (frontend/app/dashboard/page.tsx)
const formatCurrency = (value: number | null | undefined): string => {
  if (value === null || value === undefined) return 'â‚©0'
  return `â‚©${Math.round(value).toLocaleString('ko-KR')}`
}

const formatChange = (value: number | null | undefined): string => {
  // ...
}

// âœ… ì¶”ê°€í•  import
import { formatCurrency, formatChange } from '@/lib/formatters'
```

**ì‘ì—… ìƒì„¸ - Business Brain**:

```typescript
// âŒ ì‚­ì œí•  ì½”ë“œ (frontend/app/business-brain/page.tsx)
const USD_TO_KRW = 1350

function formatKRW(usdAmount: number): string {
  const krwAmount = Math.round(usdAmount * USD_TO_KRW)
  return `â‚©${krwAmount.toLocaleString()}`
}

// âœ… ì¶”ê°€í•  import
import { formatKRW, toKRW } from '@/lib/formatters'
import { CURRENCY } from '@/config/constants'
```

**ì‘ì—… ìƒì„¸ - Control Tower**:

```typescript
// âŒ ë³€ê²½ ì „ (frontend/app/control-tower/page.tsx)
const STAGE_META = {
  unreceived: { criticalDays: 7 },
  artistShipping: { criticalDays: 5 },
  // ...
}

// âœ… ë³€ê²½ í›„
import { LOGISTICS_CRITICAL_DAYS } from '@/config/businessRules'

const STAGE_META = {
  unreceived: { criticalDays: LOGISTICS_CRITICAL_DAYS.unreceived },
  artistShipping: { criticalDays: LOGISTICS_CRITICAL_DAYS.artistShipping },
  // ...
}
```

---

#### Task 1.5: Dashboard í•˜ë“œì½”ë”© ì œê±°

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 1.5.1 | ì‹ ê·œ ê³ ê° ìˆ˜ ì‹¤ì œ ë°ì´í„° ì—°ë™ | Dashboard + API | 1ì‹œê°„ | â˜‘ |
| 1.5.2 | ë°°ì†¡ ì™„ë£Œìœ¨ ì‹¤ì œ ë°ì´í„° ì—°ë™ | Dashboard + API | 1ì‹œê°„ | â˜‘ |

---

#### Task 1.6: í”„ë¡ íŠ¸ì—”ë“œ API í´ë¼ì´ì–¸íŠ¸ í‘œì¤€í™”

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 1.6.1 | API í´ë¼ì´ì–¸íŠ¸ ì„¤ì • í‘œì¤€í™” | `frontend/lib/api.ts` | 30ë¶„ | â˜‘ |
| 1.6.2 | ì—ëŸ¬ í•¸ë“¤ë§ ìœ í‹¸ë¦¬í‹° ì¶”ê°€ | `frontend/lib/errorHandler.ts` | 30ë¶„ | â˜‘ |
| 1.6.3 | íƒ€ì… ì •ì˜ íŒŒì¼ ìƒì„± | `frontend/types/api.ts` | 30ë¶„ | â˜‘ |

**êµ¬í˜„ ëª…ì„¸ - API í´ë¼ì´ì–¸íŠ¸ í‘œì¤€í™”**:

```typescript
// frontend/lib/api.ts
import axios from 'axios'
import { API } from '@/config/constants'

// Axios ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
export const apiClient = axios.create({
  baseURL: API.BASE_URL,
  timeout: API.TIMEOUT,
  headers: {
    'Content-Type': 'application/json',
  },
})

// ìš”ì²­ ì¸í„°ì…‰í„°
apiClient.interceptors.request.use(
  (config) => {
    console.log(`[API Request] ${config.method?.toUpperCase()} ${config.url}`)
    return config
  },
  (error) => Promise.reject(error)
)

// ì‘ë‹µ ì¸í„°ì…‰í„°
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    console.error('[API Error]', error.response?.data || error.message)
    return Promise.reject(error)
  }
)
```

**êµ¬í˜„ ëª…ì„¸ - ì—ëŸ¬ í•¸ë“¤ë§**:

```typescript
// frontend/lib/errorHandler.ts

export interface ApiError {
  message: string
  code?: string
  status?: number
}

export const handleApiError = (error: unknown): ApiError => {
  if (axios.isAxiosError(error)) {
    return {
      message: error.response?.data?.message || error.message,
      code: error.response?.data?.code,
      status: error.response?.status,
    }
  }
  return {
    message: error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
  }
}
```

---

#### Task 1.7: ë°±ì—”ë“œ ê³µí†µ ìœ í‹¸ë¦¬í‹° ìƒì„±

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 1.7.1 | ë°±ì—”ë“œ ìƒìˆ˜ ì •ì˜ | `backend/src/config/constants.ts` | 20ë¶„ | â˜‘ |
| 1.7.2 | ë°±ì—”ë“œ í¬ë§·íŒ… ìœ í‹¸ë¦¬í‹° | `backend/src/utils/formatters.ts` | 20ë¶„ | â˜‘ |
| 1.7.3 | ë°±ì—”ë“œ ì•ˆì „ ìœ í‹¸ë¦¬í‹° | `backend/src/utils/safeUtils.ts` | 20ë¶„ | â˜‘ |

**âš ï¸ ì¤‘ìš”**: í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œì˜ ìƒìˆ˜ ê°’(í™˜ìœ¨, ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ë“±)ì€ **ë°˜ë“œì‹œ ë™ì¼**í•´ì•¼ í•©ë‹ˆë‹¤.

```typescript
// backend/src/config/constants.ts
// âš ï¸ frontend/config/constants.tsì™€ ë™ì¼í•œ ê°’ ìœ ì§€

export const CURRENCY = {
  USD_TO_KRW: 1350,
  // ... (í”„ë¡ íŠ¸ì—”ë“œì™€ ë™ì¼)
} as const
```

**ì‘ì—… ìƒì„¸ - ì‹ ê·œ ê³ ê° ìˆ˜**:

```typescript
// âŒ í˜„ì¬ (í•˜ë“œì½”ë”©)
<EnhancedKPICard
  title="ì‹ ê·œ ê³ ê°"
  value={Math.floor(data.kpis.orderCount.value * 0.18)}  // 18% í•˜ë“œì½”ë”©!
/>

// âœ… ë³€ê²½ í›„
// 1. API ìˆ˜ì •: /api/dashboard/mainì— newCustomers ì¶”ê°€
// 2. ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •:
<EnhancedKPICard
  title="ì‹ ê·œ ê³ ê°"
  value={data.kpis.newCustomers?.value ?? 0}
  change={data.kpis.newCustomers?.change ?? 0}
/>
```

**ë°±ì—”ë“œ API ìˆ˜ì •**:

```typescript
// backend/src/routes/dashboard.ts
// newCustomers ê³„ì‚° ë¡œì§ ì¶”ê°€
const newCustomers = await calculateNewCustomers(dateRange)
// users ì‹œíŠ¸ì—ì„œ CREATED_ATì´ í•´ë‹¹ ê¸°ê°„ì¸ ì‚¬ìš©ì ìˆ˜
```

---

### 3.3 Phase 1 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

| # | í™•ì¸ í•­ëª© | ì™„ë£Œ |
|:-:|----------|:----:|
| â˜‘ | `frontend/lib/formatters.ts` ìƒì„± ë° í…ŒìŠ¤íŠ¸ í†µê³¼ | âœ… 2024-12-17 |
| â˜‘ | `frontend/lib/safeUtils.ts` ìƒì„± ë° í…ŒìŠ¤íŠ¸ í†µê³¼ | âœ… 2024-12-17 |
| â˜‘ | `frontend/lib/errorHandler.ts` ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | `frontend/config/constants.ts` ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | `frontend/config/businessRules.ts` ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | `frontend/types/api.ts` íƒ€ì… ì •ì˜ ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | `backend/src/config/constants.ts` ìƒì„± (í”„ë¡ íŠ¸ì—”ë“œì™€ ë™ì¼ ê°’) | âœ… 2024-12-17 |
| â˜‘ | `backend/src/utils/formatters.ts` ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | `backend/src/utils/safeUtils.ts` ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | Dashboard ì¤‘ë³µ í•¨ìˆ˜ ì œê±° ë° import ë³€ê²½ | âœ… 2024-12-17 |
| â˜‘ | Analytics ì¤‘ë³µ í•¨ìˆ˜ ì œê±° ë° import ë³€ê²½ | âœ… 2024-12-17 |
| â˜‘ | Settlement ì¤‘ë³µ í•¨ìˆ˜ ì œê±° ë° import ë³€ê²½ | âœ… 2024-12-17 |
| â˜‘ | Business Brain í™˜ìœ¨ ìƒìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½ | âœ… 2024-12-17 |
| â˜‘ | Control Tower ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ìƒìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½ | âœ… 2024-12-17 |
| â˜‘ | Dashboard ì‹ ê·œ ê³ ê° ìˆ˜ ì‹¤ì œ ë°ì´í„° ì—°ë™ | âœ… 2024-12-17 |
| â˜‘ | Dashboard ë°°ì†¡ ì™„ë£Œìœ¨ ì‹¤ì œ ë°ì´í„° ì—°ë™ | âœ… 2024-12-17 |
| â˜‘ | ëª¨ë“  í˜ì´ì§€ ê¸ˆì•¡ í‘œì‹œ í˜•ì‹ ì¼ì¹˜ í™•ì¸ | âœ… 2024-12-17 |
| â˜‘ | í”„ë¡ íŠ¸ì—”ë“œ/ë°±ì—”ë“œ ìƒìˆ˜ ê°’ ë™ê¸°í™” í™•ì¸ | âœ… 2024-12-17 |
| â˜ | ë¹Œë“œ ì„±ê³µ í™•ì¸ (`npm run build`) | â³ í…ŒìŠ¤íŠ¸ í•„ìš” |
| â˜‘ | ë¦°íŠ¸ ì—ëŸ¬ ì—†ìŒ í™•ì¸ (`npm run lint`) | âœ… 2024-12-17 |

### 3.4 Phase 1 ì‚°ì¶œë¬¼ ê²€ì¦

| ê²€ì¦ í•­ëª© | ê¸°ëŒ€ ê²°ê³¼ | í™•ì¸ |
|----------|----------|:----:|
| `formatCurrency(1234567)` | `'â‚©1,234,567'` | â˜‘ |
| `formatCurrency(null)` | `'â‚©0'` | â˜‘ |
| `formatChange(15.5)` | `'+15.5%'` | â˜‘ |
| `formatChange(-3.2)` | `'-3.2%'` | â˜‘ |
| `toKRW(100)` | `135000` | â˜‘ |
| `safeNumber('1,234')` | `1234` | â˜‘ |
| `safeDivide(10, 0)` | `0` | â˜‘ |

---

## 4. Phase 2: 1ì°¨ ê°€ê³µ ë°ì´í„° êµ¬ì¶•

### 4.1 Phase 2 ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ëª©í‘œ** | Layer 1 ë°ì´í„° ì¸í”„ë¼ êµ¬ì¶• |
| **ê¸°ê°„** | 2~3ì£¼ (20ì‹œê°„) |
| **ì„ í–‰ ì¡°ê±´** | Phase 1 ì™„ë£Œ |
| **ì™„ë£Œ ê¸°ì¤€** | ì¼ë³„ ì§‘ê³„ ë°°ì¹˜ Job ì •ìƒ ì‹¤í–‰ |

### 4.2 íƒœìŠ¤í¬ ëª©ë¡

#### Task 2.1: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„±

| # | ì„¸ë¶€ ì‘ì—… | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|:---------:|:----:|
| 2.1.1 | PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ SQL íŒŒì¼ ìƒì„± | 30ë¶„ | â˜‘ |
| 2.1.2 | `daily_metrics` í…Œì´ë¸” ì •ì˜ | 30ë¶„ | â˜‘ |
| 2.1.3 | `daily_review_metrics` í…Œì´ë¸” ì •ì˜ | 20ë¶„ | â˜‘ |
| 2.1.4 | `daily_coupon_metrics` í…Œì´ë¸” ì •ì˜ | 20ë¶„ | â˜‘ |
| 2.1.5 | ì¸ë±ìŠ¤ ë° íŠ¸ë¦¬ê±° ì •ì˜ | 20ë¶„ | â˜‘ |
| 2.1.6 | DB ì—°ê²° ëª¨ë“ˆ ìƒì„± (`backend/src/db/index.ts`) | 20ë¶„ | â˜‘ |

**SQL ìŠ¤í‚¤ë§ˆ**:

```sql
-- ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
CREATE DATABASE global_business_hub;

-- 1ì°¨ ê°€ê³µ: ì¼ë³„ ê¸°ë³¸ ì§€í‘œ
CREATE TABLE daily_metrics (
  id SERIAL PRIMARY KEY,
  date DATE NOT NULL UNIQUE,
  
  -- ì£¼ë¬¸ ì§€í‘œ
  order_count INT DEFAULT 0,
  total_gmv_krw DECIMAL(15,2) DEFAULT 0,
  total_gmv_usd DECIMAL(15,2) DEFAULT 0,
  avg_aov DECIMAL(15,2) DEFAULT 0,
  
  -- ê³ ê° ì§€í‘œ
  unique_customers INT DEFAULT 0,
  new_customers INT DEFAULT 0,
  returning_customers INT DEFAULT 0,
  
  -- ìƒí’ˆ/ì‘ê°€ ì§€í‘œ
  unique_artists INT DEFAULT 0,
  unique_products INT DEFAULT 0,
  
  -- êµ­ê°€ë³„ ë¶„ë¦¬
  jp_order_count INT DEFAULT 0,
  jp_gmv DECIMAL(15,2) DEFAULT 0,
  en_order_count INT DEFAULT 0,
  en_gmv DECIMAL(15,2) DEFAULT 0,
  
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 1ì°¨ ê°€ê³µ: ë¦¬ë·° ì¼ë³„ ì§€í‘œ
CREATE TABLE daily_review_metrics (
  id SERIAL PRIMARY KEY,
  date DATE NOT NULL UNIQUE,
  
  review_count INT DEFAULT 0,
  avg_rating DECIMAL(3,2) DEFAULT 0,
  rating_1 INT DEFAULT 0,
  rating_2 INT DEFAULT 0,
  rating_3 INT DEFAULT 0,
  rating_4 INT DEFAULT 0,
  rating_5 INT DEFAULT 0,
  
  -- êµ­ê°€ë³„
  jp_review_count INT DEFAULT 0,
  jp_avg_rating DECIMAL(3,2) DEFAULT 0,
  en_review_count INT DEFAULT 0,
  en_avg_rating DECIMAL(3,2) DEFAULT 0,
  
  created_at TIMESTAMP DEFAULT NOW()
);

-- 1ì°¨ ê°€ê³µ: ì¿ í° ì¼ë³„ ì§€í‘œ
CREATE TABLE daily_coupon_metrics (
  id SERIAL PRIMARY KEY,
  date DATE NOT NULL UNIQUE,
  
  active_coupons INT DEFAULT 0,
  issued_count INT DEFAULT 0,
  used_count INT DEFAULT 0,
  total_discount DECIMAL(15,2) DEFAULT 0,
  total_gmv DECIMAL(15,2) DEFAULT 0,
  
  -- ìœ í˜•ë³„
  rate_issued INT DEFAULT 0,
  rate_used INT DEFAULT 0,
  fixed_issued INT DEFAULT 0,
  fixed_used INT DEFAULT 0,
  
  created_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_daily_metrics_date ON daily_metrics(date);
CREATE INDEX idx_daily_review_metrics_date ON daily_review_metrics(date);
CREATE INDEX idx_daily_coupon_metrics_date ON daily_coupon_metrics(date);
```

---

#### Task 2.2: ë°°ì¹˜ Job ê°œë°œ

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 2.2.1 | `jobs` ë””ë ‰í† ë¦¬ ìƒì„± | `backend/src/jobs/` | 10ë¶„ | â˜‘ |
| 2.2.2 | `dailyAggregation.ts` íŒŒì¼ ìƒì„± | ìœ„ ë””ë ‰í† ë¦¬ | 1ì‹œê°„ | â˜‘ |
| 2.2.3 | `aggregateDailyMetrics()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 2.2.4 | `aggregateDailyReviewMetrics()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 45ë¶„ | â˜‘ |
| 2.2.5 | `aggregateDailyCouponMetrics()` í•¨ìˆ˜ êµ¬í˜„ | ìœ„ íŒŒì¼ | 45ë¶„ | â˜‘ |
| 2.2.6 | cron ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì • (12:00 KST) | ìœ„ íŒŒì¼ | 30ë¶„ | â˜‘ |

**êµ¬í˜„ ëª…ì„¸ - `dailyAggregation.ts`**:

```typescript
// backend/src/jobs/dailyAggregation.ts

import cron from 'node-cron'
import { sheetsService } from '../services/sheetsService'
import { db } from '../db'
import { format, subDays } from 'date-fns'

/**
 * ì¼ë³„ ê¸°ë³¸ ì§€í‘œ ì§‘ê³„
 */
async function aggregateDailyMetrics(date: string): Promise<void> {
  console.log(`[DailyMetrics] Aggregating for ${date}...`)
  
  // 1. Google Sheetsì—ì„œ í•´ë‹¹ ë‚ ì§œ ì£¼ë¬¸ ë°ì´í„° ì¡°íšŒ
  const orders = await sheetsService.getOrdersByDate(date)
  
  // 2. ì§‘ê³„ ê³„ì‚°
  const metrics = {
    date,
    order_count: orders.length,
    total_gmv_usd: orders.reduce((sum, o) => sum + (o.totalGMV || 0), 0),
    total_gmv_krw: orders.reduce((sum, o) => sum + (o.totalGMV || 0), 0) * 1350,
    avg_aov: orders.length > 0 
      ? orders.reduce((sum, o) => sum + (o.totalGMV || 0), 0) / orders.length 
      : 0,
    unique_customers: new Set(orders.map(o => o.userId)).size,
    // ... ê¸°íƒ€ ì§‘ê³„
  }
  
  // 3. DB ì €ì¥ (UPSERT)
  await db.query(`
    INSERT INTO daily_metrics (
      date, order_count, total_gmv_usd, total_gmv_krw, avg_aov, unique_customers
    ) VALUES ($1, $2, $3, $4, $5, $6)
    ON CONFLICT (date) DO UPDATE SET
      order_count = EXCLUDED.order_count,
      total_gmv_usd = EXCLUDED.total_gmv_usd,
      total_gmv_krw = EXCLUDED.total_gmv_krw,
      avg_aov = EXCLUDED.avg_aov,
      unique_customers = EXCLUDED.unique_customers,
      updated_at = NOW()
  `, [
    metrics.date,
    metrics.order_count,
    metrics.total_gmv_usd,
    metrics.total_gmv_krw,
    metrics.avg_aov,
    metrics.unique_customers
  ])
  
  console.log(`[DailyMetrics] Completed for ${date}`)
}

/**
 * ì¼ë³„ ë¦¬ë·° ì§€í‘œ ì§‘ê³„
 */
async function aggregateDailyReviewMetrics(date: string): Promise<void> {
  console.log(`[DailyReviewMetrics] Aggregating for ${date}...`)
  
  const reviews = await sheetsService.getReviewsByDate(date)
  
  const metrics = {
    date,
    review_count: reviews.length,
    avg_rating: reviews.length > 0
      ? reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length
      : 0,
    rating_1: reviews.filter(r => r.rating === 1).length,
    rating_2: reviews.filter(r => r.rating === 2).length,
    rating_3: reviews.filter(r => r.rating === 3).length,
    rating_4: reviews.filter(r => r.rating === 4).length,
    rating_5: reviews.filter(r => r.rating === 5).length,
  }
  
  await db.query(`
    INSERT INTO daily_review_metrics (
      date, review_count, avg_rating, rating_1, rating_2, rating_3, rating_4, rating_5
    ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
    ON CONFLICT (date) DO UPDATE SET
      review_count = EXCLUDED.review_count,
      avg_rating = EXCLUDED.avg_rating,
      rating_1 = EXCLUDED.rating_1,
      rating_2 = EXCLUDED.rating_2,
      rating_3 = EXCLUDED.rating_3,
      rating_4 = EXCLUDED.rating_4,
      rating_5 = EXCLUDED.rating_5
  `, [
    metrics.date,
    metrics.review_count,
    metrics.avg_rating,
    metrics.rating_1,
    metrics.rating_2,
    metrics.rating_3,
    metrics.rating_4,
    metrics.rating_5
  ])
  
  console.log(`[DailyReviewMetrics] Completed for ${date}`)
}

/**
 * ì¼ë³„ ì¿ í° ì§€í‘œ ì§‘ê³„
 */
async function aggregateDailyCouponMetrics(date: string): Promise<void> {
  console.log(`[DailyCouponMetrics] Aggregating for ${date}...`)
  
  const coupons = await sheetsService.getCouponsByDate(date)
  
  const metrics = {
    date,
    active_coupons: coupons.filter(c => c.isActive).length,
    issued_count: coupons.reduce((sum, c) => sum + (c.issue_count || 0), 0),
    used_count: coupons.reduce((sum, c) => sum + (c.used_count || 0), 0),
    total_discount: coupons.reduce((sum, c) => sum + (c.discount_amount || 0), 0),
    total_gmv: coupons.reduce((sum, c) => sum + (c.total_gmv || 0), 0),
  }
  
  await db.query(`
    INSERT INTO daily_coupon_metrics (
      date, active_coupons, issued_count, used_count, total_discount, total_gmv
    ) VALUES ($1, $2, $3, $4, $5, $6)
    ON CONFLICT (date) DO UPDATE SET
      active_coupons = EXCLUDED.active_coupons,
      issued_count = EXCLUDED.issued_count,
      used_count = EXCLUDED.used_count,
      total_discount = EXCLUDED.total_discount,
      total_gmv = EXCLUDED.total_gmv
  `, [
    metrics.date,
    metrics.active_coupons,
    metrics.issued_count,
    metrics.used_count,
    metrics.total_discount,
    metrics.total_gmv
  ])
  
  console.log(`[DailyCouponMetrics] Completed for ${date}`)
}

/**
 * ì „ì²´ ì¼ë³„ ì§‘ê³„ ì‹¤í–‰
 */
async function runDailyAggregation(): Promise<void> {
  const yesterday = format(subDays(new Date(), 1), 'yyyy-MM-dd')
  
  console.log(`[DailyAggregation] Starting for ${yesterday}...`)
  
  try {
    await aggregateDailyMetrics(yesterday)
    await aggregateDailyReviewMetrics(yesterday)
    await aggregateDailyCouponMetrics(yesterday)
    
    console.log(`[DailyAggregation] All tasks completed for ${yesterday}`)
  } catch (error) {
    console.error(`[DailyAggregation] Failed:`, error)
    throw error
  }
}

/**
 * ë°°ì¹˜ Job ì‹¤í–‰ ìŠ¤ì¼€ì¤„
 * 
 * âš ï¸ ì¤‘ìš”: Raw Data(Google Sheets)ëŠ” ë§¤ì¼ 11:00 KSTì— ìˆ˜ë™ ì—…ë°ì´íŠ¸ë¨
 * ë”°ë¼ì„œ ë°°ì¹˜ Jobì€ 12:00 KST(ì •ì˜¤)ì— ì‹¤í–‰í•˜ì—¬ ìµœì‹  ë°ì´í„° ë°˜ì˜
 * 
 * Cron í‘œí˜„ì‹: '0 12 * * *' = ë§¤ì¼ 12:00 (ì •ì˜¤)
 */
cron.schedule('0 12 * * *', runDailyAggregation, {
  timezone: 'Asia/Seoul'
})

// ìˆ˜ë™ ì‹¤í–‰ìš© export
export {
  runDailyAggregation,
  aggregateDailyMetrics,
  aggregateDailyReviewMetrics,
  aggregateDailyCouponMetrics
}
```

---

#### Task 2.3: ê³¼ê±° ë°ì´í„° ë°±í•„

| # | ì„¸ë¶€ ì‘ì—… | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|:---------:|:----:|
| 2.3.1 | ë°±í•„ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± (`backend/src/scripts/backfill.ts`) | 1ì‹œê°„ | â˜‘ |
| 2.3.2 | ìµœê·¼ 90ì¼ ë°ì´í„° ë°±í•„ ì‹¤í–‰ | 2ì‹œê°„ | â³ |
| 2.3.3 | ë°±í•„ ê²°ê³¼ ê²€ì¦ | 1ì‹œê°„ | â³ |

> **âš ï¸ ë°±í•„ ì£¼ì˜ì‚¬í•­**:
> - ë°±í•„ ì‹¤í–‰ ì „ Raw Dataê°€ í•´ë‹¹ ê¸°ê°„ê¹Œì§€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
> - Google Sheets API Rate Limit (ë¶„ë‹¹ 60íšŒ) ê³ ë ¤í•˜ì—¬ 1ì´ˆ ê°„ê²© ì‹¤í–‰
> - ë°±í•„ ì™„ë£Œ í›„ ì¼ë³„ ì§‘ê³„ í•©ê³„ì™€ Raw Data í•©ê³„ ë¹„êµ ê²€ì¦ í•„ìˆ˜

**ë°±í•„ ìŠ¤í¬ë¦½íŠ¸**:

```typescript
// backend/src/scripts/backfillDailyMetrics.ts

import { subDays, format } from 'date-fns'
import { 
  aggregateDailyMetrics, 
  aggregateDailyReviewMetrics, 
  aggregateDailyCouponMetrics 
} from '../jobs/dailyAggregation'

async function backfill(days: number = 90): Promise<void> {
  console.log(`[Backfill] Starting backfill for ${days} days...`)
  
  const today = new Date()
  
  for (let i = days; i >= 1; i--) {
    const date = format(subDays(today, i), 'yyyy-MM-dd')
    
    try {
      await aggregateDailyMetrics(date)
      await aggregateDailyReviewMetrics(date)
      await aggregateDailyCouponMetrics(date)
      
      console.log(`[Backfill] Completed ${date} (${days - i + 1}/${days})`)
    } catch (error) {
      console.error(`[Backfill] Failed for ${date}:`, error)
    }
    
    // Rate limiting
    await new Promise(resolve => setTimeout(resolve, 1000))
  }
  
  console.log(`[Backfill] All done!`)
}

// ì‹¤í–‰
backfill(90)
```

---

#### Task 2.4: ì§‘ê³„ ë°ì´í„° ì¡°íšŒ API ê°œë°œ

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 2.4.1 | `/api/metrics/daily` ì—”ë“œí¬ì¸íŠ¸ | `backend/src/routes/metrics.ts` | 1ì‹œê°„ | â˜‘ |
| 2.4.2 | `/api/metrics/summary` ì—”ë“œí¬ì¸íŠ¸ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 2.4.3 | `/api/metrics/trends/gmv` ì—”ë“œí¬ì¸íŠ¸ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 2.4.4 | `/api/metrics/reviews` ì—”ë“œí¬ì¸íŠ¸ | ìœ„ íŒŒì¼ | 30ë¶„ | â˜‘ |
| 2.4.5 | `/api/metrics/coupons` ì—”ë“œí¬ì¸íŠ¸ | ìœ„ íŒŒì¼ | 30ë¶„ | â˜‘ |
| 2.4.6 | ìˆ˜ë™ ì§‘ê³„ API (`/api/admin/trigger-aggregation`) | `backend/src/routes/admin.ts` | 1ì‹œê°„ | â˜‘ |

**API ëª…ì„¸**:

```typescript
// GET /api/metrics/daily?date=2024-12-17
interface DailyMetricsResponse {
  date: string
  orderCount: number
  totalGmvKrw: number
  totalGmvUsd: number
  avgAov: number
  uniqueCustomers: number
  newCustomers: number
  returningCustomers: number
  byCountry: {
    JP: { orderCount: number; gmv: number }
    EN: { orderCount: number; gmv: number }
  }
}

// GET /api/metrics/summary?startDate=2024-12-01&endDate=2024-12-17
interface MetricsSummaryResponse {
  period: { start: string; end: string }
  totalOrderCount: number
  totalGmvKrw: number
  avgDailyGmv: number
  avgAov: number
  totalUniqueCustomers: number
  totalNewCustomers: number
}

// GET /api/metrics/trend?startDate=2024-12-01&endDate=2024-12-17&metric=gmv
interface MetricsTrendResponse {
  metric: string
  data: Array<{ date: string; value: number }>
}
```

---

### 4.3 Phase 2 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

| # | í™•ì¸ í•­ëª© | ì™„ë£Œ |
|:-:|----------|:----:|
| â˜‘ | PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„± (`backend/src/db/schema.sql`) | âœ… 2024-12-17 |
| â˜‘ | `daily_metrics` í…Œì´ë¸” ì •ì˜ | âœ… 2024-12-17 |
| â˜‘ | `daily_review_metrics` í…Œì´ë¸” ì •ì˜ | âœ… 2024-12-17 |
| â˜‘ | `daily_coupon_metrics` í…Œì´ë¸” ì •ì˜ | âœ… 2024-12-17 |
| â˜‘ | DB ì—°ê²° ëª¨ë“ˆ (`backend/src/db/index.ts`) | âœ… 2024-12-17 |
| â˜‘ | ë°°ì¹˜ Job (`backend/src/jobs/dailyAggregation.ts`) êµ¬í˜„ | âœ… 2024-12-17 |
| â˜‘ | cron ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì • (ë§¤ì¼ 12:00 KST) | âœ… 2024-12-17 |
| â˜‘ | ìˆ˜ë™ ì§‘ê³„ íŠ¸ë¦¬ê±° API (`/api/admin/trigger-aggregation`) | âœ… 2024-12-17 |
| â˜‘ | ì§‘ê³„ ìƒíƒœ ì¡°íšŒ API (`/api/admin/aggregation-status`) | âœ… 2024-12-17 |
| â˜‘ | ê³¼ê±° ë°ì´í„° ë°±í•„ ìŠ¤í¬ë¦½íŠ¸ (`backend/src/scripts/backfill.ts`) | âœ… 2024-12-17 |
| â˜‘ | `/api/metrics/daily` API êµ¬í˜„ | âœ… 2024-12-17 |
| â˜‘ | `/api/metrics/summary` API êµ¬í˜„ | âœ… 2024-12-17 |
| â˜‘ | `/api/metrics/trends/gmv` API êµ¬í˜„ | âœ… 2024-12-17 |
| â˜‘ | `/api/metrics/reviews` API êµ¬í˜„ | âœ… 2024-12-17 |
| â˜‘ | `/api/metrics/coupons` API êµ¬í˜„ | âœ… 2024-12-17 |
| â˜‘ | `pg`, `node-cron` íŒ¨í‚¤ì§€ ì¶”ê°€ | âœ… 2024-12-17 |
| â˜ | PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì‹¤ì œ ìƒì„± | â³ ìš´ì˜ í™˜ê²½ ì„¤ì • í•„ìš” |
| â˜ | ê³¼ê±° 90ì¼ ë°ì´í„° ë°±í•„ ì‹¤í–‰ | â³ DB ì„¤ì • í›„ ì‹¤í–‰ |
| â˜ | ë°±í•„ ë°ì´í„° ì •í•©ì„± ê²€ì¦ | â³ ë°±í•„ í›„ ê²€ì¦ |
| â˜ | ë°°ì¹˜ Job 3ì¼ ì—°ì† ì •ìƒ ì‹¤í–‰ í™•ì¸ | â³ ìš´ì˜ í›„ í™•ì¸ |

---

## 5. Phase 3: 2ì°¨ ê°€ê³µ ë¶„ì„ ì²´ê³„

### 5.1 Phase 3 ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ëª©í‘œ** | Layer 2 ë¶„ì„ ë°ì´í„° í™œìš© |
| **ê¸°ê°„** | 3~4ì£¼ (44ì‹œê°„) |
| **ì„ í–‰ ì¡°ê±´** | Phase 2 ì™„ë£Œ |
| **ì™„ë£Œ ê¸°ì¤€** | ì¿ í°/ë¦¬ë·° ë¶„ì„ í˜ì´ì§€ ìš´ì˜ |

### 5.2 íƒœìŠ¤í¬ ëª©ë¡

#### Task 3.1: 2ì°¨ ê°€ê³µ ë°ì´í„° í…Œì´ë¸” ìƒì„±

| # | ì„¸ë¶€ ì‘ì—… | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|:---------:|:----:|
| 3.1.1 | `analytics_coupon` í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜ | 30ë¶„ | â˜‘ |
| 3.1.2 | `analytics_customer` í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜ | 30ë¶„ | â˜‘ |
| 3.1.3 | `analytics_order_patterns` í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜ | 30ë¶„ | â˜‘ |

**SQL ìŠ¤í‚¤ë§ˆ**:

```sql
-- 2ì°¨ ê°€ê³µ: ì¿ í° ë¶„ì„
CREATE TABLE analytics_coupon (
  id SERIAL PRIMARY KEY,
  period_start DATE NOT NULL,
  period_end DATE NOT NULL,
  
  -- ì „ì²´ ì§€í‘œ
  total_coupons INT DEFAULT 0,
  total_issued INT DEFAULT 0,
  total_used INT DEFAULT 0,
  overall_conversion_rate DECIMAL(5,4) DEFAULT 0,
  total_discount DECIMAL(15,2) DEFAULT 0,
  total_gmv DECIMAL(15,2) DEFAULT 0,
  overall_roi DECIMAL(10,2) DEFAULT 0,
  
  -- ìœ í˜•ë³„ (JSONB)
  by_discount_type JSONB,      -- { "RATE": {...}, "FIXED": {...} }
  by_coupon_type JSONB,        -- { "idus": {...}, "CRM": {...}, "Sodam": {...} }
  by_country JSONB,            -- { "JP": {...}, "EN": {...} }
  
  -- ë­í‚¹ (JSONB)
  top_by_conversion JSONB,     -- [{ couponId, name, rate, gmv }, ...]
  top_by_roi JSONB,
  failed_coupons JSONB,        -- ì „í™˜ìœ¨ 0%
  
  -- ìë™ ì¸ì‚¬ì´íŠ¸ (JSONB)
  insights JSONB,              -- [{ type, message, action }, ...]
  
  created_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(period_start, period_end)
);

-- 2ì°¨ ê°€ê³µ: ê³ ê° ë¶„ì„
CREATE TABLE analytics_customer (
  id SERIAL PRIMARY KEY,
  period_start DATE NOT NULL,
  period_end DATE NOT NULL,
  
  -- NPS
  nps_score INT DEFAULT 0,
  promoters_count INT DEFAULT 0,
  promoters_pct DECIMAL(5,2) DEFAULT 0,
  passives_count INT DEFAULT 0,
  passives_pct DECIMAL(5,2) DEFAULT 0,
  detractors_count INT DEFAULT 0,
  detractors_pct DECIMAL(5,2) DEFAULT 0,
  
  -- RFM ìš”ì•½ (JSONB)
  rfm_summary JSONB,           -- { "champions": {...}, "loyalCustomers": {...}, ... }
  
  -- ì½”í˜¸íŠ¸ ë¦¬í…ì…˜ (JSONB)
  cohort_retention JSONB,      -- { "2024-01": [100, 45, 32, ...], ... }
  
  -- ì„¸ê·¸ë¨¼íŠ¸ ì´ë™
  segment_upgrades INT DEFAULT 0,
  segment_downgrades INT DEFAULT 0,
  
  created_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(period_start, period_end)
);

-- 2ì°¨ ê°€ê³µ: ì£¼ë¬¸ íŒ¨í„´
CREATE TABLE analytics_order_patterns (
  id SERIAL PRIMARY KEY,
  period_start DATE NOT NULL,
  period_end DATE NOT NULL,
  
  -- ìš”ì¼ë³„ íŒ¨í„´ (JSONB)
  day_of_week_pattern JSONB,   -- { "monday": {...}, "tuesday": {...}, ... }
  peak_day VARCHAR(20),
  
  -- ë¶„ê¸°ë³„ íŒ¨í„´ (JSONB)
  quarterly_pattern JSONB,     -- { "Q1": {...}, "Q2": {...}, ... }
  peak_quarter VARCHAR(10),
  
  -- íŠ¸ë Œë“œ (JSONB)
  gmv_trend_7d JSONB,          -- [{ date, value }, ...]
  gmv_trend_30d JSONB,
  
  -- êµ­ê°€ë³„ íŒ¨í„´ ì°¨ì´ (JSONB)
  country_pattern_diff JSONB,
  
  created_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(period_start, period_end)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_analytics_coupon_period ON analytics_coupon(period_start, period_end);
CREATE INDEX idx_analytics_customer_period ON analytics_customer(period_start, period_end);
CREATE INDEX idx_analytics_order_patterns_period ON analytics_order_patterns(period_start, period_end);
```

---

#### Task 3.2: ì¿ í° ë¶„ì„ API ê°œë°œ

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 3.2.1 | `/api/coupon-analytics/summary` | `backend/src/routes/couponAnalytics.ts` | 2ì‹œê°„ | â˜‘ |
| 3.2.2 | `/api/coupon-analytics/trend` | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.2.3 | `/api/coupon-analytics/by-type` | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.2.4 | `/api/coupon-analytics/by-country` | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.2.5 | `/api/coupon-analytics/top-performers` | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.2.6 | `/api/coupon-analytics/failures` | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.2.7 | `/api/coupon-analytics/insights` ìë™ ì¸ì‚¬ì´íŠ¸ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |

**API ëª…ì„¸**:

```typescript
// GET /api/coupon-analytics/summary?startDate=2024-01-01&endDate=2024-12-17
interface CouponSummaryResponse {
  period: { start: string; end: string }
  totalCoupons: number
  totalIssued: number
  totalUsed: number
  overallConversionRate: number  // used / issued
  totalDiscount: number
  totalGmv: number
  roi: number                    // gmv / discount
  change: {
    conversionRate: number       // vs ì´ì „ ê¸°ê°„
    roi: number
    gmv: number
  }
}

// GET /api/coupon-analytics/trend?startDate=2024-01-01&endDate=2024-12-17
interface CouponTrendResponse {
  monthly: Array<{
    month: string               // YYYY-MM
    issued: number
    used: number
    conversionRate: number
    gmv: number
    discount: number
  }>
}

// GET /api/coupon-analytics/by-type
interface CouponByTypeResponse {
  RATE: {
    count: number
    totalIssued: number
    totalUsed: number
    avgConversion: number
    totalGmv: number
    avgRoi: number
  }
  FIXED: {
    count: number
    totalIssued: number
    totalUsed: number
    avgConversion: number
    totalGmv: number
    avgRoi: number
  }
}

// GET /api/coupon-analytics/by-country
interface CouponByCountryResponse {
  JP: {
    issued: number
    used: number
    conversionRate: number
    gmv: number
    roi: number
  }
  EN: {
    issued: number
    used: number
    conversionRate: number
    gmv: number
    roi: number
  }
}

// GET /api/coupon-analytics/top-performers?limit=10
interface TopPerformersResponse {
  byConversion: Array<{
    couponId: number
    couponName: string
    discountType: string
    conversionRate: number
    gmv: number
    roi: number
  }>
  byRoi: Array<{...}>
  byGmv: Array<{...}>
}

// GET /api/coupon-analytics/failures
interface FailedCouponsResponse {
  zeroUsage: Array<{
    couponId: number
    couponName: string
    issuedCount: number
    possibleReason: string
  }>
  lowConversion: Array<{
    couponId: number
    couponName: string
    conversionRate: number
    issuedCount: number
  }>
}
```

---

#### Task 3.3: ì¿ í° ë¶„ì„ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 3.3.1 | í˜ì´ì§€ ë¼ìš°íŠ¸ ìƒì„± | `frontend/app/coupon-analytics/page.tsx` | 30ë¶„ | â˜‘ |
| 3.3.2 | KPI ì¹´ë“œ ì„¹ì…˜ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 3.3.3 | ì›”ë³„ íŠ¸ë Œë“œ ì°¨íŠ¸ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 3.3.4 | ìœ í˜•ë³„/êµ­ê°€ë³„ ë¹„êµ ì°¨íŠ¸ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 3.3.5 | TOP ì„±ê³¼ ì¿ í° í…Œì´ë¸” | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 3.3.6 | ì‹¤íŒ¨ ì¿ í° ê²½ê³  íŒ¨ë„ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.3.7 | ìë™ ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.3.8 | ê¸°ê°„ ì„ íƒ í•„í„° | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |

---

#### Task 3.4: ë¦¬ë·° ë¶„ì„ API ê°œë°œ

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 3.4.1 | `/api/review-analytics/nps` | `backend/src/routes/reviewAnalytics.ts` | 1ì‹œê°„ | â˜‘ |
| 3.4.2 | `/api/review-analytics/trend` | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.4.3 | `/api/review-analytics/by-artist` | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.4.4 | `/api/review-analytics/rating-distribution` | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.4.5 | `/api/review-analytics/by-country` | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.4.6 | `/api/review-analytics/insights` + NPS ê³„ì‚° | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |

**NPS ê³„ì‚° ë¡œì§**:

```typescript
// 5ì  ë§Œì  ê¸°ì¤€ NPS ê³„ì‚°
function calculateNPS(reviews: Review[]): NPSResult {
  const total = reviews.length
  if (total === 0) {
    return { score: 0, promoters: 0, passives: 0, detractors: 0 }
  }
  
  // 5ì : Promoter, 4ì : Passive, 1~3ì : Detractor
  const promoters = reviews.filter(r => r.rating === 5).length
  const passives = reviews.filter(r => r.rating === 4).length
  const detractors = reviews.filter(r => r.rating <= 3).length
  
  const promotersPct = (promoters / total) * 100
  const detractorsPct = (detractors / total) * 100
  
  return {
    score: Math.round(promotersPct - detractorsPct),
    promoters,
    promotersPct,
    passives,
    passivesPct: (passives / total) * 100,
    detractors,
    detractorsPct
  }
}
```

---

#### Task 3.5: ë¦¬ë·° ë¶„ì„ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 3.5.1 | í˜ì´ì§€ ë¼ìš°íŠ¸ ìƒì„± | `frontend/app/review-analytics/page.tsx` | 30ë¶„ | â˜‘ |
| 3.5.2 | NPS ê²Œì´ì§€ ì»´í¬ë„ŒíŠ¸ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 3.5.3 | í‰ì  ë¶„í¬ ì°¨íŠ¸ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.5.4 | í‰ì  íŠ¸ë Œë“œ ì°¨íŠ¸ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 3.5.5 | ì‘ê°€ë³„ ë¶„ì„ íƒ­ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 3.5.6 | ì¸ì‚¬ì´íŠ¸ íƒ­ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 3.5.7 | êµ­ê°€ë³„ ë¹„êµ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |

---

### 5.3 Phase 3 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

| # | í™•ì¸ í•­ëª© | ì™„ë£Œ |
|:-:|----------|:----:|
| â˜‘ | `analytics_coupon` í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜ | âœ… 2024-12-17 |
| â˜‘ | `analytics_customer` í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜ | âœ… 2024-12-17 |
| â˜‘ | `analytics_order_patterns` í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜ | âœ… 2024-12-17 |
| â˜‘ | ì¿ í° ë¶„ì„ API êµ¬í˜„ (`/api/coupon-analytics/*`) | âœ… 2024-12-17 |
| â˜‘ | ì¿ í° ë¶„ì„ í”„ë¡ íŠ¸ì—”ë“œ ì™„ì„± | âœ… 2024-12-17 |
| â˜‘ | ë¦¬ë·° ë¶„ì„ API êµ¬í˜„ (`/api/review-analytics/*`) | âœ… 2024-12-17 |
| â˜‘ | ë¦¬ë·° ë¶„ì„ í”„ë¡ íŠ¸ì—”ë“œ ì™„ì„± | âœ… 2024-12-17 |
| â˜‘ | NPS ê³„ì‚° ë¡œì§ êµ¬í˜„ (5ì =Promoter, 4ì =Passive, 1~3ì =Detractor) | âœ… 2024-12-17 |
| â˜‘ | ì¿ í° ì „í™˜ìœ¨/ROI ê³„ì‚° ë¡œì§ êµ¬í˜„ | âœ… 2024-12-17 |
| â˜‘ | `/coupon-analytics` í˜ì´ì§€ ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | `/review-analytics` í˜ì´ì§€ ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ì— ì‹ ê·œ í˜ì´ì§€ ì¶”ê°€ | âœ… 2024-12-17 |
| â˜ | í˜ì´ì§€ ì •ìƒ ìš´ì˜ í…ŒìŠ¤íŠ¸ | â³ ì„œë²„ ì‹¤í–‰ í›„ í™•ì¸ |

---

## 6. Phase 4: ë³µí•© ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸

### 6.1 Phase 4 ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ëª©í‘œ** | Layer 2+ ë³µí•© í™œìš©, ë¶„ì„ í—ˆë¸Œ êµ¬ì¶• |
| **ê¸°ê°„** | 4~6ì£¼ (72ì‹œê°„) |
| **ì„ í–‰ ì¡°ê±´** | Phase 3 ì™„ë£Œ |
| **ì™„ë£Œ ê¸°ì¤€** | ë¶„ì„ í—ˆë¸Œ, ê³ ê° 360Â° ë·° ìš´ì˜ |

### 6.2 íƒœìŠ¤í¬ ëª©ë¡

#### Task 4.1: IA/ë©”ë‰´ êµ¬ì¡° ë³€ê²½

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 4.1.1 | ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • íŒŒì¼ ìˆ˜ì • | `frontend/config/navigation.ts` | 2ì‹œê°„ | â˜‘ |
| 4.1.2 | ì‚¬ì´ë“œë°” ì»´í¬ë„ŒíŠ¸ ìˆ˜ì • | `frontend/components/Sidebar.tsx` | 2ì‹œê°„ | â˜‘ |
| 4.1.3 | í—ˆë¸Œ ì„œë¸Œë©”ë‰´ UI êµ¬í˜„ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |

**ë„¤ë¹„ê²Œì´ì…˜ êµ¬ì¡°**:

```typescript
// frontend/config/navigation.ts
export const navigation = [
  {
    name: 'í™ˆ',
    icon: HomeIcon,
    children: [
      { name: 'ëŒ€ì‹œë³´ë“œ', href: '/dashboard' }
    ]
  },
  // ... ê¸°ì¡´ ë©”ë‰´
  {
    name: 'ë¶„ì„',
    icon: ChartIcon,
    children: [
      {
        name: 'ì„±ê³¼ ë¶„ì„ í—ˆë¸Œ',
        isHub: true,
        children: [
          { name: 'ì„±ê³¼ ë¶„ì„', href: '/analytics' },
          { name: 'ì£¼ë¬¸ íŒ¨í„´ ë¶„ì„', href: '/order-patterns', badge: 'NEW' },
          { name: 'ì¿ í° íš¨ê³¼ ë¶„ì„', href: '/coupon-analytics', badge: 'NEW' }
        ]
      },
      {
        name: 'ê³ ê° ë¶„ì„ í—ˆë¸Œ',
        isHub: true,
        children: [
          { name: 'ê³ ê° ë¶„ì„', href: '/customer-analytics' },
          { name: 'ê³ ê° 360Â° ë·°', href: '/customer-360', badge: 'NEW' },
          { name: 'ë¦¬ë·° ë¶„ì„', href: '/review-analytics', badge: 'NEW' }
        ]
      },
      { name: 'ì‘ê°€ ë¶„ì„', href: '/artist-analytics' },
      { name: 'ë¹„ìš© & ì†ìµ', href: '/cost-analysis' }
    ]
  },
  // ...
]
```

---

#### Task 4.2: ë¶„ì„ í—ˆë¸Œ ëœë”© í˜ì´ì§€ ê°œë°œ

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 4.2.1 | ì„±ê³¼ ë¶„ì„ í—ˆë¸Œ ëœë”© | `frontend/app/analytics/performance-hub/page.tsx` | 4ì‹œê°„ | â˜‘ |
| 4.2.2 | ê³ ê° ë¶„ì„ í—ˆë¸Œ ëœë”© | `frontend/app/analytics/customer-hub/page.tsx` | 4ì‹œê°„ | â˜‘ |
| 4.2.3 | í—ˆë¸Œ ì¸ì‚¬ì´íŠ¸ ìš”ì•½ ì»´í¬ë„ŒíŠ¸ | `frontend/components/HubInsightSummary.tsx` | 2ì‹œê°„ | â³ |

---

#### Task 4.3: ê³ ê° 360Â° ë·° ê°œë°œ

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 4.3.1 | `/api/customer-360/:userId` API | `backend/src/routes/customer360.ts` | 4ì‹œê°„ | â˜‘ |
| 4.3.2 | `/api/customer-360/search` API | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 4.3.3 | ê³ ê° ê²€ìƒ‰ ì»´í¬ë„ŒíŠ¸ | `frontend/app/customer-360/page.tsx` | 2ì‹œê°„ | â˜‘ |
| 4.3.4 | ê³ ê° í”„ë¡œí•„ í—¤ë” | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 4.3.5 | êµ¬ë§¤ ì´ë ¥ íƒ€ì„ë¼ì¸ | ìœ„ íŒŒì¼ | 3ì‹œê°„ | â˜‘ |
| 4.3.6 | RFM ì ìˆ˜ ì¹´ë“œ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 4.3.7 | ì¿ í° ì‚¬ìš© ì´ë ¥ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 4.3.8 | ë¦¬ë·° ì´ë ¥ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 4.3.9 | LTV ì¶”ì • ì¹´ë“œ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |

**API ëª…ì„¸**:

```typescript
// GET /api/customer-360/:userId
interface Customer360Response {
  profile: {
    userId: string
    email: string
    country: string
    createdAt: string
    lastOrderDate: string
    segment: string           // RFM ì„¸ê·¸ë¨¼íŠ¸
  }
  
  rfm: {
    recency: number           // ë§ˆì§€ë§‰ êµ¬ë§¤ í›„ ì¼ìˆ˜
    frequency: number         // êµ¬ë§¤ íšŸìˆ˜
    monetary: number          // ì´ êµ¬ë§¤ì•¡
    score: string             // "5-4-5" í˜•íƒœ
    segment: string           // "Champions", "Loyal Customers", ...
  }
  
  orders: Array<{
    orderId: string
    orderDate: string
    totalAmount: number
    itemCount: number
    status: string
  }>
  
  coupons: Array<{
    couponId: number
    couponName: string
    usedDate: string
    discountAmount: number
  }>
  
  reviews: Array<{
    reviewId: string
    productName: string
    rating: number
    content: string
    date: string
  }>
  
  ltv: {
    estimatedValue: number
    confidence: number
    basis: string             // ê³„ì‚° ê·¼ê±°
  }
}
```

---

#### Task 4.4: Business Brain í™•ì¥

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 4.4.1 | ì¿ í° ì¸ì‚¬ì´íŠ¸ íƒ­ ì¶”ê°€ | `frontend/app/business-brain/page.tsx` | 4ì‹œê°„ | â˜‘ |
| 4.4.2 | ë¦¬ë·° ì¸ì‚¬ì´íŠ¸ íƒ­ ì¶”ê°€ | ìœ„ íŒŒì¼ | 4ì‹œê°„ | â˜‘ |
| 4.4.3 | `/api/business-brain/coupon-insights` | `backend/src/routes/business-brain.ts` | 2ì‹œê°„ | â˜‘ |
| 4.4.4 | `/api/business-brain/review-insights` | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |

---

#### Task 4.5: ì£¼ë¬¸ íŒ¨í„´ ë¶„ì„ í˜ì´ì§€ ê°œë°œ

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 4.5.1 | `/api/order-patterns/*` API | `backend/src/routes/orderPatterns.ts` | 4ì‹œê°„ | â˜‘ |
| 4.5.2 | í˜ì´ì§€ ë¼ìš°íŠ¸ ìƒì„± | `frontend/app/order-patterns/page.tsx` | 1ì‹œê°„ | â˜‘ |
| 4.5.3 | ìš”ì¼ë³„ íˆíŠ¸ë§µ | ìœ„ íŒŒì¼ | 3ì‹œê°„ | â˜‘ |
| 4.5.4 | ë¶„ê¸°ë³„ ì‹œì¦ˆë„ë¦¬í‹° ì°¨íŠ¸ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |
| 4.5.5 | êµ­ê°€ë³„ íŒ¨í„´ ë¹„êµ | ìœ„ íŒŒì¼ | 2ì‹œê°„ | â˜‘ |

---

### 6.3 Phase 4 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

| # | í™•ì¸ í•­ëª© | ì™„ë£Œ |
|:-:|----------|:----:|
| â˜‘ | ë„¤ë¹„ê²Œì´ì…˜ êµ¬ì¡° ë³€ê²½ ì™„ë£Œ | âœ… 2024-12-17 |
| â˜‘ | ì„±ê³¼ ë¶„ì„ í—ˆë¸Œ ëœë”© í˜ì´ì§€ ìš´ì˜ | âœ… 2024-12-17 |
| â˜‘ | ê³ ê° ë¶„ì„ í—ˆë¸Œ ëœë”© í˜ì´ì§€ ìš´ì˜ | âœ… 2024-12-17 |
| â˜‘ | ê³ ê° 360Â° ë·° API êµ¬í˜„ | âœ… 2024-12-17 |
| â˜‘ | ê³ ê° 360Â° ë·° í”„ë¡ íŠ¸ì—”ë“œ ì™„ì„± | âœ… 2024-12-17 |
| â˜‘ | Business Brain ì¿ í° íƒ­ ì¶”ê°€ | âœ… 2024-12-17 |
| â˜‘ | Business Brain ë¦¬ë·° íƒ­ ì¶”ê°€ | âœ… 2024-12-17 |
| â˜‘ | ì£¼ë¬¸ íŒ¨í„´ ë¶„ì„ í˜ì´ì§€ ìš´ì˜ | âœ… 2024-12-17 |
| â˜‘ | ëª¨ë“  í—ˆë¸Œ ê°„ ë§í¬ ì •ìƒ ë™ì‘ | âœ… 2024-12-17 |

---

## 7. Phase 5: ì˜ˆì¸¡Â·ìë™í™” í™•ì¥

### 7.1 Phase 5 ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ëª©í‘œ** | Layer 3+ êµ¬ì¡° ì¤€ë¹„ |
| **ê¸°ê°„** | 1~2ì£¼ (18ì‹œê°„) |
| **ì„ í–‰ ì¡°ê±´** | Phase 4 ì™„ë£Œ |
| **ì™„ë£Œ ê¸°ì¤€** | ì˜ˆì¸¡/ìë™í™” í…Œì´ë¸” ë° ì¸í„°í˜ì´ìŠ¤ ì¤€ë¹„ |
| **âš ï¸ ì£¼ì˜** | ì‹¤ì œ ML ëª¨ë¸ êµ¬í˜„ì€ í–¥í›„ Phase |

### 7.2 íƒœìŠ¤í¬ ëª©ë¡

#### Task 5.1: ì˜ˆì¸¡ ë°ì´í„° êµ¬ì¡° ìƒì„±

| # | ì„¸ë¶€ ì‘ì—… | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|:---------:|:----:|
| 5.1.1 | `predictions` í…Œì´ë¸” ìƒì„± | 1ì‹œê°„ | â˜‘ |
| 5.1.2 | `recommendations` í…Œì´ë¸” ìƒì„± | 1ì‹œê°„ | â˜‘ |
| 5.1.3 | `automation_rules` í…Œì´ë¸” ìƒì„± | 1ì‹œê°„ | â˜‘ |
| 5.1.4 | `automation_logs` í…Œì´ë¸” ìƒì„± | 30ë¶„ | â˜‘ |

**SQL ìŠ¤í‚¤ë§ˆ**:

```sql
-- ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥
CREATE TABLE predictions (
  id SERIAL PRIMARY KEY,
  prediction_type VARCHAR(50) NOT NULL,   -- 'churn', 'gmv', 'ltv'
  entity_type VARCHAR(50) NOT NULL,       -- 'customer', 'artist', 'overall'
  entity_id VARCHAR(100),
  
  predicted_value DECIMAL(15,4),
  confidence DECIMAL(5,4),
  
  model_version VARCHAR(50),
  training_period_start DATE,
  training_period_end DATE,
  
  created_at TIMESTAMP DEFAULT NOW(),
  expires_at TIMESTAMP
);

-- ì¶”ì²œ ê²°ê³¼ ì €ì¥
CREATE TABLE recommendations (
  id SERIAL PRIMARY KEY,
  recommendation_type VARCHAR(50),        -- 'coupon', 'action', 'target'
  target_entity_type VARCHAR(50),
  target_entity_id VARCHAR(100),
  
  recommendation_content JSONB,
  priority INT,
  
  model_version VARCHAR(50),
  created_at TIMESTAMP DEFAULT NOW()
);

-- ìë™í™” ê·œì¹™
CREATE TABLE automation_rules (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  
  trigger_type VARCHAR(50),               -- 'threshold', 'schedule', 'event'
  trigger_condition JSONB,
  
  action_type VARCHAR(50),                -- 'alert', 'email', 'slack'
  action_config JSONB,
  
  enabled BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_predictions_type ON predictions(prediction_type, entity_type);
CREATE INDEX idx_predictions_entity ON predictions(entity_type, entity_id);
CREATE INDEX idx_recommendations_type ON recommendations(recommendation_type);
CREATE INDEX idx_automation_rules_enabled ON automation_rules(enabled);
```

---

#### Task 5.2: ì˜ˆì¸¡ API ì¸í„°í˜ì´ìŠ¤ ì •ì˜

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 5.2.1 | `/api/predictions/*` ë¼ìš°íŠ¸ êµ¬ì¡° | `backend/src/routes/predictions.ts` | 2ì‹œê°„ | â˜‘ |
| 5.2.2 | ì˜ˆì¸¡ ê²°ê³¼ ì¡°íšŒ API (churn, gmv, ltv) | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 5.2.3 | ì¶”ì²œ ê²°ê³¼ ì¡°íšŒ API | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 5.2.4 | ìë™í™” ê·œì¹™ API (CRUD) | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 5.2.5 | ëª¨ë¸ ì •ë³´ ë° ìƒíƒœ API | ìœ„ íŒŒì¼ | 30ë¶„ | â˜‘ |
| 5.2.6 | í”„ë¡ íŠ¸ì—”ë“œ API í´ë¼ì´ì–¸íŠ¸ ì¶”ê°€ | `frontend/lib/api.ts` | 30ë¶„ | â˜‘ |

**API ëª…ì„¸ (êµ¬ì¡°ë§Œ ì •ì˜)**:

```typescript
// GET /api/predictions/churn?limit=100
interface ChurnPredictionsResponse {
  predictions: Array<{
    customerId: string
    churnProbability: number
    confidence: number
    riskFactors: string[]
    recommendedAction: string
  }>
  modelVersion: string
  generatedAt: string
}

// GET /api/predictions/gmv-forecast
interface GmvForecastResponse {
  forecast: {
    nextWeek: { value: number; confidence: number }
    nextMonth: { value: number; confidence: number }
    nextQuarter: { value: number; confidence: number }
  }
  modelVersion: string
  trainingPeriod: { start: string; end: string }
}

// GET /api/recommendations/coupon?segment=at_risk
interface CouponRecommendationsResponse {
  recommendations: Array<{
    targetSegment: string
    suggestedType: 'RATE' | 'FIXED'
    suggestedDiscount: number
    expectedConversion: number
    expectedRoi: number
    reasoning: string
  }>
}
```

---

#### Task 5.3: ML í•™ìŠµ ë°ì´í„° í¬ë§· ì •ì˜

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 5.3.1 | ì´íƒˆ ì˜ˆì¸¡ìš© í”¼ì²˜ ì •ì˜ | `docs/ml-feature-specs.md` | 2ì‹œê°„ | â˜‘ |
| 5.3.2 | GMV ì˜ˆì¸¡ìš© í”¼ì²˜ ì •ì˜ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 5.3.3 | LTV ì˜ˆì¸¡ìš© í”¼ì²˜ ì •ì˜ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 5.3.4 | ë°ì´í„° ì¶”ì¶œ ìŠ¤í¬ë¦½íŠ¸ í…œí”Œë¦¿ | `backend/src/scripts/extractMLData.ts` | 2ì‹œê°„ | â³ |

**í”¼ì²˜ ì •ì˜ ì˜ˆì‹œ**:

```typescript
// ì´íƒˆ ì˜ˆì¸¡ìš© í”¼ì²˜
interface ChurnPredictionFeatures {
  // ê³ ê° ê¸°ë³¸ ì •ë³´
  customerId: string
  daysSinceFirstOrder: number
  daysSinceLastOrder: number
  
  // RFM í”¼ì²˜
  recencyScore: number
  frequencyScore: number
  monetaryScore: number
  
  // í–‰ë™ í”¼ì²˜
  totalOrders: number
  totalGmv: number
  avgOrderValue: number
  avgDaysBetweenOrders: number
  
  // ìµœê·¼ í™œë™ í”¼ì²˜
  ordersLast30Days: number
  ordersLast90Days: number
  gmvLast30Days: number
  gmvLast90Days: number
  
  // ë¦¬ë·° í”¼ì²˜
  totalReviews: number
  avgRating: number
  
  // ì¿ í° í”¼ì²˜
  couponsUsed: number
  couponUsageRate: number
  
  // íƒ€ê²Ÿ
  churned: boolean  // 180ì¼ ì´ìƒ ë¯¸êµ¬ë§¤
}
```

---

#### Task 5.4: ì˜ˆì¸¡ ê²°ê³¼ í‘œì‹œ UI êµ¬ì¡°

| # | ì„¸ë¶€ ì‘ì—… | íŒŒì¼ | ì˜ˆìƒ ì‹œê°„ | ì™„ë£Œ |
|:-:|----------|------|:---------:|:----:|
| 5.4.1 | ì˜ˆì¸¡ ê²°ê³¼ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ | `frontend/components/predictions/PredictionCard.tsx` | 2ì‹œê°„ | â˜‘ |
| 5.4.2 | ì´íƒˆ ì˜ˆì¸¡ ì¹´ë“œ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 5.4.3 | GMV ì˜ˆì¸¡ ì¹´ë“œ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 5.4.4 | LTV ì˜ˆì¸¡ ì¹´ë“œ | ìœ„ íŒŒì¼ | 1ì‹œê°„ | â˜‘ |
| 5.4.5 | ëª¨ë¸ ìƒíƒœ ì¹´ë“œ | ìœ„ íŒŒì¼ | 30ë¶„ | â˜‘ |
| 5.4.6 | ìë™í™” ê·œì¹™ ì¹´ë“œ | ìœ„ íŒŒì¼ | 30ë¶„ | â˜‘ |
| 5.4.7 | Business Brain ì˜ˆì¸¡ íƒ­ êµ¬ì¡° | `frontend/app/business-brain/page.tsx` | 2ì‹œê°„ | â³ |

---

### 7.3 Phase 5 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

| # | í™•ì¸ í•­ëª© | ì™„ë£Œ |
|:-:|----------|:----:|
| â˜‘ | `predictions` í…Œì´ë¸” ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | `recommendations` í…Œì´ë¸” ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | `automation_rules` í…Œì´ë¸” ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | `automation_logs` í…Œì´ë¸” ìƒì„± | âœ… 2024-12-17 |
| â˜‘ | ì˜ˆì¸¡ API ì¸í„°í˜ì´ìŠ¤ ì •ì˜ ì™„ë£Œ | âœ… 2024-12-17 |
| â˜‘ | í”„ë¡ íŠ¸ì—”ë“œ API í´ë¼ì´ì–¸íŠ¸ ì¶”ê°€ | âœ… 2024-12-17 |
| â˜‘ | ML í”¼ì²˜ ì •ì˜ ë¬¸ì„œ ì‘ì„± | âœ… 2024-12-17 |
| â˜‘ | ì˜ˆì¸¡ ê²°ê³¼ UI ì»´í¬ë„ŒíŠ¸ ìƒì„± | âœ… 2024-12-17 |
| â³ | ë°ì´í„° ì¶”ì¶œ ìŠ¤í¬ë¦½íŠ¸ í…œí”Œë¦¿ ì‘ì„± | í–¥í›„ ì‘ì—… |
| â³ | Business Brain ì˜ˆì¸¡ íƒ­ í†µí•© | í–¥í›„ ì‘ì—… |

### 7.4 Phase 5 ì´í›„ í™•ì¥ ë¡œë“œë§µ

| í™•ì¥ ì˜ì—­ | ì„ í–‰ ì¡°ê±´ | ì˜ˆìƒ ì‹œì  |
|----------|----------|----------|
| ì´íƒˆ ì˜ˆì¸¡ ëª¨ë¸ | ê³ ê° ë°ì´í„° 6ê°œì›”+ | Phase 5 ì™„ë£Œ í›„ 3ê°œì›” |
| GMV ì˜ˆì¸¡ ëª¨ë¸ | ì¼ë³„ ì§‘ê³„ 1ë…„+ | Phase 5 ì™„ë£Œ í›„ 6ê°œì›” |
| ì¿ í° ì¶”ì²œ ëª¨ë¸ | ì¿ í° íš¨ê³¼ ë°ì´í„° 1ë…„+ | Phase 5 ì™„ë£Œ í›„ 6ê°œì›” |
| ìë™í™” ì•¡ì…˜ | ê·œì¹™ ê²€ì¦ ì™„ë£Œ | Phase 5 ì™„ë£Œ í›„ 3ê°œì›” |

---

## 8. í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 8.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

| ëª¨ë“ˆ | í…ŒìŠ¤íŠ¸ í•­ëª© | ì™„ë£Œ |
|------|-----------|:----:|
| `formatters.ts` | ëª¨ë“  í¬ë§· í•¨ìˆ˜ edge case | â˜ |
| `safeUtils.ts` | null, undefined, NaN ì²˜ë¦¬ | â˜ |
| ì¿ í° ë¶„ì„ API | ì „í™˜ìœ¨, ROI ê³„ì‚° ì •í™•ì„± | â˜ |
| ë¦¬ë·° ë¶„ì„ API | NPS ê³„ì‚° ì •í™•ì„± | â˜ |
| ê³ ê° 360Â° API | ë°ì´í„° í†µí•© ì •í™•ì„± | â˜ |

### 8.2 í†µí•© í…ŒìŠ¤íŠ¸

| ì‹œë‚˜ë¦¬ì˜¤ | í…ŒìŠ¤íŠ¸ í•­ëª© | ì™„ë£Œ |
|----------|-----------|:----:|
| ì¼ë³„ ë°°ì¹˜ | ì§‘ê³„ Job ì‹¤í–‰ â†’ DB ì €ì¥ í™•ì¸ | â˜ |
| ì¿ í° ë¶„ì„ | API í˜¸ì¶œ â†’ í”„ë¡ íŠ¸ì—”ë“œ í‘œì‹œ | â˜ |
| ë¦¬ë·° ë¶„ì„ | API í˜¸ì¶œ â†’ NPS ê²Œì´ì§€ í‘œì‹œ | â˜ |
| ê³ ê° 360Â° | ê²€ìƒ‰ â†’ ìƒì„¸ ì¡°íšŒ â†’ ë°ì´í„° ì¼ì¹˜ | â˜ |

### 8.3 E2E í…ŒìŠ¤íŠ¸

| ì‹œë‚˜ë¦¬ì˜¤ | í…ŒìŠ¤íŠ¸ í•­ëª© | ì™„ë£Œ |
|----------|-----------|:----:|
| ë¶„ì„ í—ˆë¸Œ íƒìƒ‰ | ë©”ë‰´ â†’ í—ˆë¸Œ â†’ ìƒì„¸ í˜ì´ì§€ ì´ë™ | â˜ |
| ì¿ í° ë¶„ì„ íë¦„ | ê¸°ê°„ ì„ íƒ â†’ KPI í™•ì¸ â†’ ìƒì„¸ ë“œë¦´ë‹¤ìš´ | â˜ |
| ê³ ê° 360Â° íë¦„ | ê²€ìƒ‰ â†’ ì„ íƒ â†’ ì „ì²´ ì •ë³´ í™•ì¸ | â˜ |

---

## 9. ë¶€ë¡: ì½”ë“œ í…œí”Œë¦¿

### 9.1 API ë¼ìš°íŠ¸ í…œí”Œë¦¿

```typescript
// backend/src/routes/[feature].ts
import { Router, Request, Response } from 'express'
import { db } from '../db'

const router = Router()

/**
 * GET /api/[feature]/[endpoint]
 * @description [ì„¤ëª…]
 */
router.get('/[endpoint]', async (req: Request, res: Response) => {
  try {
    const { startDate, endDate } = req.query
    
    // íŒŒë¼ë¯¸í„° ê²€ì¦
    if (!startDate || !endDate) {
      return res.status(400).json({ error: 'startDate and endDate are required' })
    }
    
    // ë°ì´í„° ì¡°íšŒ
    const result = await db.query(`
      SELECT * FROM [table]
      WHERE date BETWEEN $1 AND $2
    `, [startDate, endDate])
    
    // ì‘ë‹µ
    res.json({
      period: { start: startDate, end: endDate },
      data: result.rows
    })
  } catch (error) {
    console.error('[API Error]', error)
    res.status(500).json({ error: 'Internal server error' })
  }
})

export default router
```

### 9.2 ë¶„ì„ í˜ì´ì§€ í…œí”Œë¦¿

```typescript
// frontend/app/[feature]/page.tsx
'use client'

import { useState } from 'react'
import { useQuery } from '@tanstack/react-query'
import { format, subDays } from 'date-fns'
import { [feature]Api } from '@/lib/api'
import { formatCurrency, formatPercent } from '@/lib/formatters'

export default function [Feature]Page() {
  // ê¸°ê°„ ìƒíƒœ
  const [dateRange, setDateRange] = useState({
    start: format(subDays(new Date(), 30), 'yyyy-MM-dd'),
    end: format(new Date(), 'yyyy-MM-dd')
  })
  
  // ë°ì´í„° ì¡°íšŒ
  const { data, isLoading, error } = useQuery({
    queryKey: ['[feature]', dateRange],
    queryFn: () => [feature]Api.getSummary(dateRange)
  })
  
  if (isLoading) return <LoadingSpinner />
  if (error) return <ErrorMessage error={error} />
  
  return (
    <div className="space-y-6">
      {/* í—¤ë” */}
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold">[Feature] ë¶„ì„</h1>
        <DateRangePicker value={dateRange} onChange={setDateRange} />
      </div>
      
      {/* KPI ì¹´ë“œ */}
      <div className="grid grid-cols-4 gap-4">
        <KPICard title="[ì§€í‘œ1]" value={formatCurrency(data?.metric1)} />
        <KPICard title="[ì§€í‘œ2]" value={formatPercent(data?.metric2)} />
        {/* ... */}
      </div>
      
      {/* ì°¨íŠ¸ */}
      <div className="grid grid-cols-2 gap-4">
        <Card title="[ì°¨íŠ¸1]">
          <TrendChart data={data?.trend} />
        </Card>
        <Card title="[ì°¨íŠ¸2]">
          <PieChart data={data?.distribution} />
        </Card>
      </div>
      
      {/* í…Œì´ë¸” */}
      <Card title="[ìƒì„¸ ë°ì´í„°]">
        <DataTable data={data?.details} columns={columns} />
      </Card>
    </div>
  )
}
```

---

## 10. ë¶€ë¡: ìš©ì–´ ì •ì˜

### 10.1 ë°ì´í„° ë ˆì´ì–´ ìš©ì–´

| ìš©ì–´ | ì •ì˜ | ì˜ˆì‹œ |
|------|------|------|
| **L0 (Layer 0)** | Raw Data, ì›ì²œ ë°ì´í„° | Google Sheetsì˜ order, logistics ì‹œíŠ¸ |
| **L1 (Layer 1)** | 1ì°¨ ê°€ê³µ ë°ì´í„° (ì •ì œ, í‘œì¤€í™”, ê¸°ë³¸ ì§‘ê³„) | `daily_metrics`, `daily_review_metrics` |
| **L2 (Layer 2)** | 2ì°¨ ê°€ê³µ ë°ì´í„° (íŒŒìƒ ì§€í‘œ, ë¹„êµ ë¶„ì„) | `analytics_coupon`, NPS ì ìˆ˜, RFM ìš”ì•½ |
| **L3+ (Layer 3+)** | nì°¨ ê°€ê³µ ë°ì´í„° (ì˜ˆì¸¡, ì¶”ì²œ, ìë™í™”) | ì´íƒˆ ì˜ˆì¸¡ ê²°ê³¼, ì¿ í° ì¶”ì²œ |

### 10.2 ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´

| ìš©ì–´ | ì •ì˜ | ê³„ì‚°ì‹/ê¸°ì¤€ |
|------|------|------------|
| **GMV** | Gross Merchandise Value, ì´ ê±°ë˜ì•¡ | ì£¼ë¬¸ ê¸ˆì•¡ í•©ê³„ |
| **AOV** | Average Order Value, í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡ | GMV / ì£¼ë¬¸ ìˆ˜ |
| **NPS** | Net Promoter Score, ìˆœ ì¶”ì²œ ì§€ìˆ˜ | (Promoter% - Detractor%) |
| **RFM** | Recency, Frequency, Monetary | ìµœê·¼ì„±, ë¹ˆë„, ê¸ˆì•¡ ê¸°ë°˜ ì„¸ê·¸ë¨¼íŠ¸ |
| **ROI** | Return on Investment, íˆ¬ì ìˆ˜ìµë¥  | (GMV - í• ì¸ì•¡) / í• ì¸ì•¡ |
| **ì „í™˜ìœ¨** | Conversion Rate | ì‚¬ìš© ìˆ˜ / ë°œí–‰ ìˆ˜ |
| **LTV** | Lifetime Value, ê³ ê° ìƒì•  ê°€ì¹˜ | ì˜ˆìƒ ì´ êµ¬ë§¤ì•¡ |

### 10.3 ê¸°ìˆ  ìš©ì–´

| ìš©ì–´ | ì •ì˜ |
|------|------|
| **ë°°ì¹˜ Job** | ì •í•´ì§„ ì‹œê°„ì— ìë™ ì‹¤í–‰ë˜ëŠ” ì‘ì—… |
| **UPSERT** | INSERT + UPDATE, ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸ ì—†ìœ¼ë©´ ì‚½ì… |
| **ë°±í•„ (Backfill)** | ê³¼ê±° ë°ì´í„°ë¥¼ ì†Œê¸‰í•˜ì—¬ ì²˜ë¦¬ |
| **ì˜¨ë””ë§¨ë“œ** | í•„ìš” ì‹œ ì¦‰ì‹œ ì‹¤í–‰ |
| **cron** | Unix ê¸°ë°˜ ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ |

### 10.4 í”„ë¡œì íŠ¸ ì•½ì–´

| ì•½ì–´ | ì „ì²´ ëª…ì¹­ |
|------|----------|
| **KST** | Korea Standard Time (UTC+9) |
| **KRW** | Korean Won (ì›í™”) |
| **USD** | US Dollar (ë‹¬ëŸ¬) |
| **API** | Application Programming Interface |
| **DB** | Database |
| **UI** | User Interface |
| **IA** | Information Architecture |

---

## 11. ë¶€ë¡: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### 11.1 í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜

```bash
# .env.local (Frontend)
NEXT_PUBLIC_API_URL=http://localhost:3001

# .env (Backend)
DATABASE_URL=postgresql://user:password@localhost:5432/global_business_hub
GOOGLE_SHEETS_ID=18wVO8auhIrGiZR0TpuqzdBVqByxPBi-3LxypKCwExe8
GOOGLE_SERVICE_ACCOUNT_EMAIL=your-service-account@project.iam.gserviceaccount.com
GOOGLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"
```

### 11.2 ì„ íƒì  í™˜ê²½ ë³€ìˆ˜

```bash
# ë¡œê¹… ë ˆë²¨
LOG_LEVEL=info

# ë°°ì¹˜ Job ì„¤ì •
BATCH_ENABLED=true
BATCH_TIMEZONE=Asia/Seoul

# ì•Œë¦¼ ì„¤ì • (Phase 5)
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...
```

---

## 12. ë¶€ë¡: íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### 12.1 ë°°ì¹˜ Job ì‹¤íŒ¨ ì‹œ

| ì¦ìƒ | ì›ì¸ | í•´ê²° ë°©ë²• |
|------|------|----------|
| Google Sheets ì—°ê²° ì˜¤ë¥˜ | ì¸ì¦ ë§Œë£Œ | ì„œë¹„ìŠ¤ ê³„ì • í‚¤ ì¬ë°œê¸‰ |
| ë°ì´í„° ëˆ„ë½ | Raw Data ë¯¸ê°±ì‹  | 11:00 ì´í›„ ìˆ˜ë™ ê°±ì‹  í™•ì¸ |
| DB ì €ì¥ ì‹¤íŒ¨ | ì—°ê²° ë¬¸ì œ | DATABASE_URL í™•ì¸ |
| ì¤‘ë³µ ì‹¤í–‰ | cron ì„¤ì • ì˜¤ë¥˜ | ìŠ¤ì¼€ì¤„ëŸ¬ ë¡œê·¸ í™•ì¸ |

### 12.2 ìˆ˜ë™ ë°°ì¹˜ ì‹¤í–‰

```bash
# íŠ¹ì • ë‚ ì§œ ì§‘ê³„ ì¬ì‹¤í–‰
npm run batch:daily -- --date=2024-12-16

# ê¸°ê°„ ë°±í•„
npm run batch:backfill -- --from=2024-12-01 --to=2024-12-16
```

### 12.3 ë°ì´í„° ì •í•©ì„± ê²€ì¦

```sql
-- ì¼ë³„ ì§‘ê³„ ë°ì´í„° í™•ì¸
SELECT date, order_count, total_gmv_krw 
FROM daily_metrics 
ORDER BY date DESC 
LIMIT 7;

-- Raw Dataì™€ ë¹„êµ (ì£¼ë¬¸ ìˆ˜)
SELECT COUNT(*) as raw_count 
FROM orders 
WHERE DATE(order_date) = '2024-12-16';
```

---

## ğŸ“‹ ë¬¸ì„œ ë³€ê²½ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|:----:|------|----------|
| 1.0 | 2024-12-17 | ìµœì´ˆ ì‘ì„± |
| 1.1 | 2024-12-17 | ë°°ì¹˜ ì‹¤í–‰ ì‹œê°„ 12:00 KSTë¡œ ë³€ê²½, ìš©ì–´ ì •ì˜/í™˜ê²½ ë³€ìˆ˜/íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì¶”ê°€ |
| 1.2 | 2024-12-17 | **Phase 4-5 ì™„ë£Œ**: ë¶„ì„ í—ˆë¸Œ ëœë”© í˜ì´ì§€, BB ì¿ í°/ë¦¬ë·° íƒ­, ì˜ˆì¸¡ API/UI ì»´í¬ë„ŒíŠ¸, ML í”¼ì²˜ ë¬¸ì„œ |

---

> **ë¬¸ì„œ ê´€ë¦¬ì**: AI ìë™í™”íŒ€  
> **ìµœì¢… ì—…ë°ì´íŠ¸**: 2024-12-17  
> **ê´€ë ¨ ë¬¸ì„œ**: `í—ˆë¸Œ_ê°œì„ _ì œì•ˆì„œ.md`, `ë°ì´í„°_ê·œì¹™_ê°€ì´ë“œ.md`, `ml-feature-specs.md`

